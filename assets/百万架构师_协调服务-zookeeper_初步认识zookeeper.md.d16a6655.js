import{_ as s,o as a,h as n,Q as p}from"./chunks/framework.da611722.js";const l="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkEAAADmCAYAAADSglHSAAANyklEQVR4nO3dL2wb5//A8Y9/GujQd7BsBXFBVTBYnUnL5pR0pNJQi84wIQOTJnWTykZs6JBqaFJRSG2NZSDW4EBVUFtqYeHg2P1AHP+LndhNsrT5vF5SpLR57u6JSd+9e+6uVlVVFQAAyfzfVU8AAOAqiCAAICURBACkJIIAgJREEACQkggCAFL6YpPB3333Xezv71/WXAAA1nLz5s3o9/vxzTfffPQ+NjoTJIAAgE/Bhw8f4u+//z7XPjY6E3Ts3bt3cevWrXMdGADgYzx48CAODg7OvR9rggCAlEQQAJCSCAIAUhJBAEBKIggASEkEAQApiSAAICURBACkJIIAgJREEACQkggCAFISQQBASiIIAEhJBAEAKYkgACAlEQQApCSCAICUPoEIGkWnUYtarRa1Rif6Vz2da8VnCwCrfAIRNGPw5qpncH35bAFgzqcVQQAA/xERBACkdHUR1G8drVWp1WN3cPyXe7FdG69hGX+1TlnIMhr1o9NqRGNhm0ajFZ3+aPV2ncZ4bGuyTmbUb0WjMbOfRiNaJ/Yxiv7C8RqNVpxyqLltj47RmJ9rq7PW9st/18b4+As7uIDPFgCuvWoDEVFFRPXu3btNNltq2C4m+zvtq+wt3bpql2tsX5RVb3jascuqVw2rdnHKPo4nMGxXxcpjFSvmeXzAXlWedoyIqmgvmeia2y5uf77PFgA+bffv368ionrx4sW59nNlEVRVVTUcDqvhsDcTIWXVGw7Hfz+shku7YDFaiqoo21Wv16t6vV7VLouFWCmrxX/rZyOhKKb7Kdvtqtdrnwissiyn+yyKqmz3ql6vvRAnJ49zpFeVc2F2vH2vardn9htFtayDeuVM6JTtuc+nd8r2H/fZAsCn71pE0JHh/D/UZ42ePctRtKvl/5bPh9LiWZYTZ0qW7GfZ2ZSi7C2Mmz/OsjMrc/s5sf3RPnrt4tQIOnncuQGnnE3a7LMFgM/BRUXQZ7YwehSvXh4vcimi/dtObC0dtxU7v7WjGP9psPvr6mfkFO0YHp7cz9bOT1HO/kXZi8Nuc2HcVuz8NB31+u3i4p5+/DpZlFNG78T2R/to7hzGsPdTPFzyyzS71ZLjzg54NJnn4M1w1SgAYMHnFUGjVzFpoPKn2FlZBhGx9TAeH1dQvI4TfTLZzaqQqsedyfZHAbN82J1pbC1GyOhtvJ7s4lGs2MPRdJunhM66Xr+NtdZoAwCfWQQN38TkPNCd+hmDt+LhpIIGcWknSbZux91VP9tovhsYjWI0+bq43QJAJl9c9QQ2MXo7Oa8Sd29vdt7k9dtRRPPc51o2cp75Luwp+p1f4/nLvRgMzh4NAJzts4qglEadaNR3Q/sAwMX6vC6HzTi5CPl05zsTc36bzvdIP1ozAVSU7egNh1Ed3dU3/urNL+AGANbyWZ0J2rp9N2KcBEeLkE8Lm/k7yS5ySc66NpvvEv392Bt/W7SHcXjqSnAAYBOf15mgmdvBY29/9W3vEfN3khWPl95+fuk2mu/oxJ1dF7emCABY9AlE0FbcntxetfpW9iPNeDStithudJbfEj6av4y0+jb4y7Yw31Z/yXxH0e80olavx68LlbQ1/WBWXE4bRb/1fHK26KRNPlsAyOUTiKCI+p3prey79Ua0Ov3o9zvRajSisxAGze7MGpjBbtRrjaOXkPaPtum0GlGrb0/DoOzFqkf8/BeaP0wf2hh721FvHP9+/eh3WtFo1GN7dxBLL9nNPghxtx6NTn9ya/xk273Tl0xv8tkCQCqbPF46LuW1GVV14v1aZ73kc7j43q4VLxVd8bqJ2VdZrH6J6LqvnJiZ+6qd9cpTXr56xgtUZ16LsfSrKKv28e+z9DUiG362APCJu2avzWhGd9iLdlnM/W1RtuOHZWdxtnaieziMYa8dZVEs/LAY30V1xusmxmPvnPLT2yufgrihZjcOh8PolUXMT3dmrqsWPTe7UQ17J37Poiii7A1jeNiNh6cffLPPFgCSqFVVVa09uFaLiIh3797FrVu3Lm1SAACrPHjwIA4ODuLFixfx9OnTj97PJ3ImCADgvyWCAICURBAAkJIIAgBSEkEAQEoiCABISQQBACmJIAAgJREEAKQkggCAlEQQAJCSCAIAUhJBAEBKIggASEkEAQApiSAAICURBACkJIIAgJREEACQkggCAFISQQBASiIIAEhJBAEAKX1x1RPg+vrrr7/ixx9/vOppAPARvvrqq/j999/jxo0bVz2VSyOCuDTdbjcODg6uehoAfKS//vor7t+/f9XTuDQiiEv39OnTePLkyVVPA4A1ff/99/Hhw4ernsalE0Fcuq+//vpa/08C4Lq5zpfAZlkYDQCkJIIAgJREEACQkggCAFISQQBASiIIAEhJBAEAKYkgACAlEQQApCSCAICURBAAkJIIAgBSEkEAQEoiCABISQQBACmJIAAgJREEAKQkggCAlEQQAJCSCAIAUhJBcF6jTjRqtajValFr9VeP67eOxtRq0eiM1hrX6s+PG4360Wk1pser1aJWa0Sj0Yr+6JR9RsSo0xiPb8XRLEfRaTWm+2m0on/6LgCuFREE57X1MB4X4+/39mNVBo3evp58P3j5Klb1Rn9/b/xdEXfqW+ON+9Fq1KJe347dvUEM5rYYxGCwF9v1+ulxNX+UaDXqsbs3s6fBXuwP19wc4BoQQXBuW/FwWkGxv7SCRvHq5WxwvIxXS3tlFJNWKh7Hw3ED9X/djuNeKcp29IbDGI6/eu0yjo8+2H0SZ3fQ63jeGO+vKKJs96LXbkdZFHGnfta2ANfHF1c9AbgOtm7fjRifn9nb70e32VwYMYw3c6dvBvFmGBFbC8NGr+K4lYrHD+d+XJS9+K3bPLHJ1k43mrcjatt7ETGIl69GsbOzOGr+2INBRBTtGB7ujPfXjObOzpm/J8B14kwQXITmoyiPv3/99uSlrv5+7EVEFGWU49M2e0tOGY1evZxc6rp7exoyzW4Vh0sCaNnxB2/WuaZVRm8SQAA5iSC4EM14NKmQk5e6Jut87j6KHx5PKujE+qHh5HRRGY8WTyata1mELSh73fjY3QNcFyIILkhzWkHxcq6Cput8ykfN8aWziIjX8XauVvoxWRNdPjo7UkajGE2+zjd3gIxEEFyU2UtSs3d/Tdb5jBceT8YtxNLxJbM4iqWTRtHvtKLRGN/SXq9HffK1PdkWgPWIILgwKy6JDd8crfOZ3O01HTcbS9Nb45dcCht1olGrx/bu3tGiZgDOTQTBBarfmdysHsfrk6frgW5PFiJPxk1iaebW+BOXwvrRqu9OFkwf3yJfVdXMV2+6MBuAtYgguEBbDx/H9LmJ/Zhd5zN7iWs6bhxLM7fGn7gUNnOZrGgP47C7E80t93UBnJcIgou0+PTo0ds4OsGz8CDCmXF7+/2ZW+NPPrBw9knTs7fNA3A+Iggu1PzTo58/ebmwHmg6bnKT2N7zeDJ9QuLCuJi5myzi9dtlt4GNot96bmE0wIZEEFyw2Utig/Eq5sWnP0fM31I/WPGU6PHA6V1nu/VodPqTW+OP7harx/ae1dIAmxJBcNFmL4mNLb2MNfuU6YiIKOLx4mmgo4HR7U1HDna3J7fGT+4WK8pot4sl2wKwigiCCzd7SSxi9dOf69Nb6iOWXgqbaHajGvaiLOZDpyiKKHvDGB524+Ha8yviztpjAa4vL1CFS7C1cxjVme8j3Ypmt4qqu+5Om9E9bMbK4Wccc705AeThTBAAkJIIAgBSEkEAQEoiCABISQQBACmJIAAgJREEAKQkggCAlEQQAJCSCAIAUhJBAEBKIggASEkEAQApiSAAICURBACkJIIAgJREEACQkggCAFISQQBASiIIAEhJBAEAKYkgACAlEQQApCSCAICURBAAkJIIAgBSEkEAQEoiCABISQQBACmJIAAgJREEAKQkggCAlEQQAJCSCAIAUhJBAEBKIggASEkEAQApiSAAICURBACkJIIAgJREEACQkggCAFISQQBASiIIAEhJBAEAKYkgACAlEQQApCSCAICURBAAkJIIAgBSEkEAQEoiCABISQQBACmJIAAgJREEAKQkggCAlEQQAJCSCAIAUhJBAEBKIggASEkEAQApiSAAICURBACkJIIAgJREEACQkggCAFISQQBASiIIAEhJBAEAKYkgACAlEQQApCSCAICURBAAkJIIAgBSEkEAQEoiCABISQQBACmJIAAgJREEAKQkggCAlEQQAJCSCAIAUhJBAEBKIggASEkEAQApiSAAICURBACkJIIAgJREEACQkggCAFISQQBASl9c9QS4/v7888/4+eefr3oaAKzpn3/+ueop/CdEEJfmxo0bERFxcHAQBwcHVzwbAJgngrg0T548iffv38e///571VMBYEO3bt2Ke/fuXfU0LpUI4tLcu3cv+v3+VU8DAJayMBoASEkEAQApiSAAICURBACkJIIAgGvpl19+OfXnIggASEkEAQDXwllnfhaJIADgs7dpAEV85MMSO51O/O9///uYTQEAzuX9+/dzf54NoNnvnz17dup+alVVVese9Msvv/QKBADgk/DixYt4+vRpREzj56zwmbXRmaBnz57FH3/8sckmAAAX7ubNm/Htt99O/vzs2bONL4ltdCYIAOC6sDAaAEhJBAEAKYkgACAlEQQApCSCAICURBAAkJIIAgBSEkEAQEoiCABISQQBACmJIAAgpf8HUCWbEKqCPDwAAAAASUVORK5CYII=",e="/assets/JavaGuide-Zookeeper-初步认识-Webservice-订单服务.f4c30450.png",o="/assets/JavaGuide-Zookeeper-初步认识-Webservice-订单服务多台实例.0fc8bc7b.png",r="/assets/JavaGuide-Zookeeper-初步认识-Webservice-订单服务多台实例-地址管理.73b5a9dc.png",c="/assets/JavaGuide-Zookeeper-初步认识-Webservice-订单服务多台实例-地址管理-协议地址维护.7d29887c.png",t="/assets/JavaGuide-Zookeeper-初步认识-注册中心地址薄.8b54aa76.png",i="/assets/JavaGuide-Zookeeper-初步认识-zookeeper-目录结构.4ac4c996.png",y="/assets/JavaGuide-Zookeeper-初步认识-zookeeper-中间件本身的地址问题-zookeeper历史.2f16ef79.png",E="/assets/JavaGuide-Zookeeper-初步认识-zookeeper-中间件本身的地址问题-zookeeper设计目标.bd5cf3b3.png",d="/assets/JavaGuide-Zookeeper-初步认识-zookeeper-数据同步问题.9b115ccd.png",h="/assets/JavaGuide-Zookeeper-初步认识-zookeeper-服务实例目录.f2d9455b.png",u="/assets/JavaGuide-Zookeeper-初步认识-zookeeper-服务地址-临时节点.244ff514.png",b="/assets/JavaGuide-Zookeeper-初步认识-zookeeper-Leader-Follower集群.56ba3616.png",F="/assets/JavaGuide-Zookeeper-初步认识-zookeeper-节点特性.e7769e83.png",C="/assets/JavaGuide-Zookeeper-初步认识-zookeeper-会话状态.d4c33ece.png",m="/assets/JavaGuide-Zookeeper-初步认识-zookeeper-Watcher机制.92d421c2.png",v="/assets/JavaGuide-Zookeeper-初步认识-zookeeper-作为配置中心.7c24082c.png",g="/assets/JavaGuide-Zookeeper-初步认识-zookeeper-负载均衡.72e8656e.png",S=JSON.parse('{"title":"初步认识zookeeper | JavaGuide","description":"","frontmatter":{"head":[["link",{"rel":"canonical","href":"https://javaguide.net/百万架构师/协调服务-zookeeper/初步认识zookeeper.html"}],["meta",{"name":"keywords","content":"初步认识zookeeper , JavaGuide , JavaGuide官网, Java面试指南, Java基础, 多线程, JVM, 虚拟机, 数据库, MySQL, Spring, Redis, MyBatis, 系统设计, 分布式, RPC, 高可用, 高并发"}],["meta",{"name":"og:url","content":"https://JavaGuide.net"}],["meta",{"name":"og:type","content":"website"}],["meta",{"name":"og:image","content":"https://javaguide.net/JavaGuide-og.png"}],["meta",{"name":"og:title","content":"初步认识zookeeper | JavaGuide | Java面试指南 | JavaGuide官网"}],["meta",{"name":"og:description","content":"初步认识zookeeper | JavaGuide | Java面试指南 | JavaGuide官网 | 「JavaGuide.net」一份涵盖大部分 Java 程序员所需要掌握的核心知识。准备 Java 面试，首选 JavaGuide.net ！"}],["meta",{"name":"twitter:site","content":"https://javaguide.net"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:creator","content":"nogeek.cn"}],["meta",{"name":"twitter:title","content":"初步认识zookeeper | JavaGuide | Java面试指南 | JavaGuide官网"}],["meta",{"name":"twitter:description","content":"初步认识zookeeper | JavaGuide | Java面试指南 | JavaGuide官网 | 「JavaGuide.net」一份涵盖大部分 Java 程序员所需要掌握的核心知识。准备 Java 面试，首选 JavaGuide.net ！"}],["meta",{"name":"twitter:image","content":"https://javaguide.net/JavaGuide-og.png"}],["meta",{"name":"sogou_site_verification","content":"fcAkazTXFd"}],["meta",{"name":"baidu-site-verification","content":"codeva-MXEPYsXKGk"}],["meta",{"name":"msvalidate.01","content":"9F2D57CFC59E8031212A166878638B15"}]]},"headers":[],"relativePath":"百万架构师/协调服务-zookeeper/初步认识zookeeper.md","filePath":"百万架构师/协调服务-zookeeper/初步认识zookeeper.md","lastUpdated":1741277271000}'),k={name:"百万架构师/协调服务-zookeeper/初步认识zookeeper.md"},A=p('<ol><li><p>从架构的发展过程说起</p></li><li><p>什么是zookeeper</p></li><li><p>Zookeeper安装部署</p></li><li><p>Zoo.cfg配置文件分析</p></li></ol><h5 id="zookeeper-下边有-zookeeper-out-日志记录" tabindex="-1">zookeeper 下边有 zookeeper.out 日志记录 <a class="header-anchor" href="#zookeeper-下边有-zookeeper-out-日志记录" aria-label="Permalink to &quot;zookeeper 下边有 zookeeper.out 日志记录&quot;">​</a></h5><p>架构不是一蹴而就的，是随着我们业务量的不断增加，不断去演变的。</p><p>架构的演变</p><p>单体架构 tomcat war</p><p><img src="'+l+'" alt="JavaGuide-Zookeeper-初步认识-单体-Tomcat-War.png"></p><p>​</p><p>目标是很快地解决产品的迭代问题，交付问题。</p><h1 id="单体架构" tabindex="-1">单体架构 <a class="header-anchor" href="#单体架构" aria-label="Permalink to &quot;单体架构&quot;">​</a></h1><p>体量增长，后端的架构的性能有瓶颈，后端的架构无法支撑如此大的流量。</p><p>垂直的方式，增加硬件设备的个数、性能，提升整体的性能。</p><p>投入的产出比会越来越小。</p><p>然后采用水平的伸缩方式提升架构的性能。</p><p>在不改变应用程序和应用程序状态的情况下，通过水平的伸缩去提升整体的性能。</p><h2 id="水平伸缩" tabindex="-1">水平伸缩 <a class="header-anchor" href="#水平伸缩" aria-label="Permalink to &quot;水平伸缩&quot;">​</a></h2><p>对完整的产品进行一个拆分，拆分成不同的模块。</p><p>一般来说，对于一个产品一般是根据业务领域进行拆分，</p><p>例子：用户服务， 订单服务 商品服务</p><p><img src="'+e+'" alt="JavaGuide-Zookeeper-初步认识-Webservice-订单服务.png"></p><p>远程过程调用</p><p>例如 ：基于SOAP协议的webservice进行远程过程调用，</p><h1 id="形成分布式架构" tabindex="-1">形成分布式架构 <a class="header-anchor" href="#形成分布式架构" aria-label="Permalink to &quot;形成分布式架构&quot;">​</a></h1><p>分布架构通过不同的计算机网络通过远程过程调用组成的一个整体。</p><p>当服务越来越多，通过拆分服务，服务会拆分越来越细，做水平扩展，做集群高可用。</p><p>服务成百上千个，某个服务可能做成成百上千的集群。</p><p><img src="'+o+'" alt="JavaGuide-Zookeeper-初步认识-Webservice-订单服务多台实例.png"></p><p>HTTP、SOAP、WSDL</p><p>在每个节点上需要去维护远程服务接口的信息。IP地址、参数格式。</p><p>调用其他服务时需要根据wsdl文档生成对应的一些代码去做远程过程调用。</p><h2 id="拆分服务" tabindex="-1">拆分服务 <a class="header-anchor" href="#拆分服务" aria-label="Permalink to &quot;拆分服务&quot;">​</a></h2><p>如果某一个服务不是一个单一的节点，他进行了成百上千的高可用的配置大规模的集群。</p><p>那么就必须得维护成百上千的访问地址的维护。</p><p><img src="'+r+`" alt="JavaGuide-Zookeeper-初步认识-Webservice-订单服务多台实例-地址管理.png"></p><h1 id="怎么解决地址维护的管理" tabindex="-1">怎么解决地址维护的管理 <a class="header-anchor" href="#怎么解决地址维护的管理" aria-label="Permalink to &quot;怎么解决地址维护的管理&quot;">​</a></h1><h2 id="如何转发-负载均衡" tabindex="-1">如何转发，负载均衡 <a class="header-anchor" href="#如何转发-负载均衡" aria-label="Permalink to &quot;如何转发，负载均衡&quot;">​</a></h2><p>而且调用这个服务时请求如何进行转发。负载均衡机制。</p><p>如果集群中的某个节点宕机了怎么办，会有很多错误的请求</p><h2 id="产生了三个问题" tabindex="-1">产生了三个问题： <a class="header-anchor" href="#产生了三个问题" aria-label="Permalink to &quot;产生了三个问题：&quot;">​</a></h2><ol><li><pre><code> 协议地址的维护
</code></pre></li><li><pre><code> 负载均衡机制
</code></pre></li><li><pre><code> 服务动态的上下线感知
</code></pre></li></ol><p><img src="`+c+'" alt="JavaGuide-Zookeeper-初步认识-Webservice-订单服务多台实例-地址管理-协议地址维护.png"></p><p>Zookeeper由此产生了。</p><h2 id="需要有一个中间件" tabindex="-1">需要有一个中间件， <a class="header-anchor" href="#需要有一个中间件" aria-label="Permalink to &quot;需要有一个中间件，&quot;">​</a></h2><p>当服务发布的时候，告诉中间件，（类似于电话簿的功能）这个服务的地址。</p><p>他需要记住所有服务的地址，并且服务断开的话，还需要知道服务断开了</p><p>消费端在需要调用服务端的时候直接去中间件去获得地址。在客户端就不需要一个一个地去维护服务端的地址。在客户端，我只需要维护中间件的地址就好了。从中间件中获得目标服务的信息。拿到目标服务的地址以后就可以做一个转发，List地址簿，根据对应的负载算法，完成一个转发。而且中间件也可以感知服务发布以后的宕机与上线情况。并且客户端，从中间件上拿到地址以后还可以感知到服务端的宕机与上线的变化。</p><p>这是我们的目标。</p><p><img src="'+t+'" alt="JavaGuide-Zookeeper-初步认识-注册中心地址薄.png"></p><h2 id="zookeeper" tabindex="-1">Zookeeper <a class="header-anchor" href="#zookeeper" aria-label="Permalink to &quot;Zookeeper&quot;">​</a></h2><p>Zookeeper是一种树形结构</p><p>Zookeeper数据的数据方式是基于key-value形式，</p><p>但它的存储方式是基于树形的文件方式的存储</p><p><img src="'+i+'" alt="JavaGuide-Zookeeper-初步认识-zookeeper-目录结构.png"></p><p>所以每一种服务建立一个节点，在这个节点下再建立多个节点维护地址信息。客户端只需要检测这个节点就可以拿到所有的地址信息，然后进行处理和调用。</p><h2 id="有人说zookeeper不适合做注册中心" tabindex="-1">有人说zookeeper不适合做注册中心 <a class="header-anchor" href="#有人说zookeeper不适合做注册中心" aria-label="Permalink to &quot;有人说zookeeper不适合做注册中心&quot;">​</a></h2><p>但是很多公司都用它在做注册中心，问题不是很大。</p><h2 id="zookeeper是一个分布式协调服务" tabindex="-1">Zookeeper是一个分布式协调服务 <a class="header-anchor" href="#zookeeper是一个分布式协调服务" aria-label="Permalink to &quot;Zookeeper是一个分布式协调服务&quot;">​</a></h2><p>它是一个“动物园”，用来管理我们的中间件组件。</p><h2 id="zookeeper历史" tabindex="-1">Zookeeper历史： <a class="header-anchor" href="#zookeeper历史" aria-label="Permalink to &quot;Zookeeper历史：&quot;">​</a></h2><p>Zookeeper起源于雅虎，一开始是为了解决分布式锁的问题。</p><p>如果多个服务调用同一块资源，然后就会存在资源竞争的问题。</p><p><img src="'+y+'" alt="JavaGuide-Zookeeper-初步认识-zookeeper-中间件本身的地址问题-zookeeper历史.png"></p><p>多线程是一个进程里边的多个线程的并发的问题。可以通过(synochronized lock)去做。</p><p>而在分布式架构中是多进程，传统的锁是没办法解决的。</p><p>所以我们通过zookeeper去协调在各个节点之间去控制节点的接入顺序，所以叫zookeeper协调。</p><p>这是zookeeper最初的设计目标。</p><p><img src="'+E+'" alt="JavaGuide-Zookeeper-初步认识-zookeeper-中间件本身的地址问题-zookeeper设计目标.png"></p><p>如果在协调的时候成百上千个服务访问同一块资源，这时候就会存在中间件的单点问题。所以我们会对zookeeper做集群。</p><p>我们对中间件做集群是为了保证中间件的高性能，高可用。</p><p>然后就会存在中间件集群上的数据同步问题。</p><p><img src="'+d+'" alt="JavaGuide-Zookeeper-初步认识-zookeeper-数据同步问题.png"></p><p>我们zookeeper集群中有一个leader两个slave，我们的每个节点上都要存储数据，</p><p>我们</p><p>就是我们每一个zookeeper节点上的数据的同步的问题。</p><p>CAP理论，既要保证高性能，还要保证高可用是做不到的！！！存在网络通讯的状态。</p><p>Zookeeper集群的数据的提交方式是基于2PC的二阶提交的方式去做的。</p><p>它的一致性是通过最终一致性来实现的。</p><p>Zookeeper可以有多个同级节点。</p><p><img src="'+h+`" alt="JavaGuide-Zookeeper-初步认识-zookeeper-服务实例目录.png"></p><p>Zookeeper有了很多个服务节点，一个zookeeper上的资源（相当于单点），不同的服务不可以同时地访问这个zookeeper上的资源，这时候就会存在瓶颈。</p><p>Zookeeper集群就产生了。</p><p>Zookeeper集群是一主多从的机制，</p><p>一个leader</p><p>Follower follower</p><p>做这个集群能够保证流量可以被分摊，同时也可以保证高可用，如果leader坏了，可以进行新的选举，选举出一个新的leader替换上。这是它用来完成高可用的一种机制。</p><p>我们现在的zookeeper是一个集群，我们的客户端可以访问集群中的任意一个节点。</p><p>这时候就需要数据的同步。</p><p>如果我们用户服务在leader上创建了一个服务，然后订单服务在follower上去查询的时候发现这个服务不存在！！ 这时候就存在数据不一致的情况。因此我们集群就需要涉及数据的同步。</p><p>我们一定要有leader</p><p>我们所有的事务请求要放在leader上，我们的其他请求要放在follower上。</p><p>如果我们的事务请求可以放在任意一个节点上，这时候就意味着没有中心化节点。</p><p>Redis-cluster就是一个无中心化的集群（基于GossIP的协议）</p><p>无中心化的时候，那么事务的控制就会变得更加地复杂。</p><p>为了简化复杂性，</p><p>所以我们一般采取</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">Leader</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Follower</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">follower</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">Leader</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Follower</span><span style="color:#24292E;">     </span><span style="color:#032F62;">follower</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>集群的机制。</p><p>所有的事务请求都落在leader节点上，然后其他请求落在follower节点上</p><p>我们的事务请求落在leader上时，需要同步数据到follower上，</p><p>这时候数据的同步就涉及了CAP，</p><p>这时候既要满足我们可以对外提供服务，也要保证这是高性能的。</p><p>如果我们的用户服务往leader上创建了一个节点，但是同步完成之前，我不能给用户一个响应的话，那么这时候用户服务去操作数据的时候就会一直等待。如果操作需要等待，性能就会降低，所以我们不可能用强一致性。</p><p>Zookeeper基于2PC协议完成了一个改造版的2PC协议去保证最终一致性。</p><h3 id="去中心化" tabindex="-1">去中心化 <a class="header-anchor" href="#去中心化" aria-label="Permalink to &quot;去中心化&quot;">​</a></h3><p>现在我们的项目都是有一个中心化，有一个项目组长，一帮码农去开发，然后他给你分配任务。</p><p>这个时候这个项目组长就是一个中心节点。</p><p>如果项目组长身体不好，就会重新选出一个组长来开发，</p><p>所谓的去中心化，就是一个团队里边，没有所谓的组长，所有人都是一个平等的，全都是程序员。然后按照领域去划分任务，一个任务过来了，判断属于哪一个领域，然后谁去处理就好了。去中心化的好处就是不会出现单点故障。</p><p>全球互联网化就是一个去中心化的思想。就是一个机房中的一个电脑出现故障不会影响整个互联网内其他电脑的是否可以上网，这就是一个去中心化的好处。</p><h3 id="通信异常" tabindex="-1">通信异常 <a class="header-anchor" href="#通信异常" aria-label="Permalink to &quot;通信异常&quot;">​</a></h3><p>通过分布式架构演变以后，我们的每一个服务调用，它是基于一个远程服务调用。远程服务通信它本身就是不可靠的，由于一些不可控的因素导致，这个服务在某个时间内是不可用的。如果服务的通信不可用的话，就会存在访问的消息的丢失。</p><h3 id="存在三态" tabindex="-1">存在三态 <a class="header-anchor" href="#存在三态" aria-label="Permalink to &quot;存在三态&quot;">​</a></h3><p>正常情况下只会存在两种状态</p><ul><li>一种是成功</li><li>一种是失败</li></ul><p>然后在分布式机构中会存在第三种状态，</p><ul><li>未知状态，可能是超时</li></ul><p>可能我们的请求发过去以后，可能已经收到了，处理了，可能一直没有返回，也有可能在返回过程中出现网络故障，就会出现超时。</p><h1 id="zookeeper-1" tabindex="-1">Zookeeper <a class="header-anchor" href="#zookeeper-1" aria-label="Permalink to &quot;Zookeeper&quot;">​</a></h1><p>Zookeeper 它是一个分布式协调服务，它是由雅虎创建的，是google chubby开源实现的，它是为了解决分布式架构里的复杂的容易出错的一致性的问题，就是我们的协调问题。这是zookeeper设计的初衷。</p><p>凡是一些中间件都会有一个配置文件</p><p>Zookeeper是开源的。直接在官网上去下载，会有一个 <code>*.tar.gz</code> 的压缩包</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#  tar –zxvf zookeeper-3.4.10.tar.gz</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#  tar –zxvf zookeeper-3.4.10.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>解压缩以后就可以运行了</p><p>解压缩以后可以在zookeeper的目录下</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#  cd zookeeper-3.4.10</span></span>
<span class="line"><span style="color:#6A737D;"># ls</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#  cd zookeeper-3.4.10</span></span>
<span class="line"><span style="color:#6A737D;"># ls</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>启动之前还需要改一下配置文件</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># cd conf/</span></span>
<span class="line"><span style="color:#6A737D;"># ls</span></span>
<span class="line"><span style="color:#6A737D;"># cp zoo_sample.cfg zoo.cfg</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># cd conf/</span></span>
<span class="line"><span style="color:#6A737D;"># ls</span></span>
<span class="line"><span style="color:#6A737D;"># cp zoo_sample.cfg zoo.cfg</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>默认会读取 <code>zoo.cfg</code>这个文件，我们拷贝这个文件。</p><p>Zookeeper有个配置文件，凡是中间件都有一个对应的配置文件，去对一些参数做一些优化和去配置一些可自定义的一些参数</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># vim zoo.cfg</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># vim zoo.cfg</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>可以看到一些配置文件</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># cd ..</span></span>
<span class="line"><span style="color:#6A737D;"># cd bin/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># cd ..</span></span>
<span class="line"><span style="color:#6A737D;"># cd bin/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>进入到bin目录下</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># sh zkServer.sh start</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># sh zkServer.sh start</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="然后zookeeper启动以后" tabindex="-1">然后zookeeper启动以后 <a class="header-anchor" href="#然后zookeeper启动以后" aria-label="Permalink to &quot;然后zookeeper启动以后&quot;">​</a></h4><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># sh zkCli.sh</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># sh zkCli.sh</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="连接" tabindex="-1">连接 <a class="header-anchor" href="#连接" aria-label="Permalink to &quot;连接&quot;">​</a></h4><p>这样我们就连接到了远程服务，我们通过客户端连接到了远程服务，然后我们可以进行一些操作。</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">WatchedEvent</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">state:SyncConnected</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type:None</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">path:null</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">WatchedEvent</span><span style="color:#24292E;"> </span><span style="color:#032F62;">state:SyncConnected</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type:None</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path:null</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>我们一个客户端通过zkClient.sh去访问zookeeper，然后就可以远程操作命令，</p><p>Zookeeper是一个树形的操作结构，它只是一个树形结构，但是数据都会存在节点上</p><p>Help</p><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ZooKeeper </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">server host:port cmd args</span></span>
<span class="line"><span style="color:#E1E4E8;">   stat path [watch]</span></span>
<span class="line"><span style="color:#E1E4E8;">   set path data [version]</span></span>
<span class="line"><span style="color:#E1E4E8;">   ls path [watch]</span></span>
<span class="line"><span style="color:#E1E4E8;">   delquota [</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">n</span><span style="color:#F97583;">|-</span><span style="color:#E1E4E8;">b] path</span></span>
<span class="line"><span style="color:#E1E4E8;">   ls2 path [watch]</span></span>
<span class="line"><span style="color:#E1E4E8;">   setAcl path acl</span></span>
<span class="line"><span style="color:#E1E4E8;">   setquota </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">n</span><span style="color:#F97583;">|-</span><span style="color:#E1E4E8;">b val path</span></span>
<span class="line"><span style="color:#E1E4E8;">   history</span></span>
<span class="line"><span style="color:#E1E4E8;">   redo cmdno</span></span>
<span class="line"><span style="color:#E1E4E8;">   printwatches on</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">off</span></span>
<span class="line"><span style="color:#E1E4E8;">   delete path [version]</span></span>
<span class="line"><span style="color:#E1E4E8;">   sync path</span></span>
<span class="line"><span style="color:#E1E4E8;">   listquota path</span></span>
<span class="line"><span style="color:#E1E4E8;">   rmr path</span></span>
<span class="line"><span style="color:#E1E4E8;">   get path [watch]</span></span>
<span class="line"><span style="color:#E1E4E8;">   create [</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">s] [</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">e] path data acl</span></span>
<span class="line"><span style="color:#E1E4E8;">   addauth scheme auth</span></span>
<span class="line"><span style="color:#E1E4E8;">   quit</span></span>
<span class="line"><span style="color:#E1E4E8;">   getAcl path</span></span>
<span class="line"><span style="color:#E1E4E8;">   close</span></span>
<span class="line"><span style="color:#E1E4E8;">   connect host:port</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ZooKeeper </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">server host:port cmd args</span></span>
<span class="line"><span style="color:#24292E;">   stat path [watch]</span></span>
<span class="line"><span style="color:#24292E;">   set path data [version]</span></span>
<span class="line"><span style="color:#24292E;">   ls path [watch]</span></span>
<span class="line"><span style="color:#24292E;">   delquota [</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">n</span><span style="color:#D73A49;">|-</span><span style="color:#24292E;">b] path</span></span>
<span class="line"><span style="color:#24292E;">   ls2 path [watch]</span></span>
<span class="line"><span style="color:#24292E;">   setAcl path acl</span></span>
<span class="line"><span style="color:#24292E;">   setquota </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">n</span><span style="color:#D73A49;">|-</span><span style="color:#24292E;">b val path</span></span>
<span class="line"><span style="color:#24292E;">   history</span></span>
<span class="line"><span style="color:#24292E;">   redo cmdno</span></span>
<span class="line"><span style="color:#24292E;">   printwatches on</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">off</span></span>
<span class="line"><span style="color:#24292E;">   delete path [version]</span></span>
<span class="line"><span style="color:#24292E;">   sync path</span></span>
<span class="line"><span style="color:#24292E;">   listquota path</span></span>
<span class="line"><span style="color:#24292E;">   rmr path</span></span>
<span class="line"><span style="color:#24292E;">   get path [watch]</span></span>
<span class="line"><span style="color:#24292E;">   create [</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">s] [</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">e] path data acl</span></span>
<span class="line"><span style="color:#24292E;">   addauth scheme auth</span></span>
<span class="line"><span style="color:#24292E;">   quit</span></span>
<span class="line"><span style="color:#24292E;">   getAcl path</span></span>
<span class="line"><span style="color:#24292E;">   close</span></span>
<span class="line"><span style="color:#24292E;">   connect host:port</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>数据怎么去创建，涉及创建命令</p><p>客户端要发起一些命令去操作这些节点</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>增</td><td>create</td></tr><tr><td>删</td><td>delete</td></tr><tr><td>改</td><td>set</td></tr><tr><td>查</td><td>get</td></tr></tbody></table><p>创建的时候必须一层一层创建。</p><p>删除的时候必须一层一层地往上删除。</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Help</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Help</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>命令可以看到</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Create /orderservice 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Ls /</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Create   path    value</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Create /orderservice 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Ls /</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Create   path    value</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>作为一个设计者，一定要具备节点的唯一性，在当前的节点下，不能出现名字一样的两个节点</p><h2 id="zookeeper的特性" tabindex="-1">Zookeeper的特性： <a class="header-anchor" href="#zookeeper的特性" aria-label="Permalink to &quot;Zookeeper的特性：&quot;">​</a></h2><ol><li><pre><code> 同级节点的唯一性
</code></pre></li><li><pre><code> 临时节点和持久化节点的特性
</code></pre></li><li><pre><code> 有序节点和无序节点
</code></pre></li><li><pre><code> 节点存在父子关系，必须有先后
</code></pre></li><li><pre><code> 临时节点下不能存在子节点
</code></pre></li></ol><p>临时节点的特性：</p><p>在客户端建立的会话周期中，创建的临时节点，会话结束以后会自动删除。</p><p>有序节点：</p><p>如果我们创建的是有序节点的话，会带有一个数字 <code>00000000000001</code></p><p>​ <code>00000000000002</code></p><h3 id="创建一个节点" tabindex="-1">创建一个节点 <a class="header-anchor" href="#创建一个节点" aria-label="Permalink to &quot;创建一个节点&quot;">​</a></h3><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;">] create /orderservice 1</span></span>
<span class="line"><span style="color:#B392F0;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/orderservice</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">] create /orderservice/wsdl darian</span></span>
<span class="line"><span style="color:#B392F0;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/orderservice/wsdl</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">33</span><span style="color:#E1E4E8;">] get /orderservice/wsdl</span></span>
<span class="line"><span style="color:#B392F0;">darian</span></span>
<span class="line"><span style="color:#B392F0;">cZxid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xd</span></span>
<span class="line"><span style="color:#B392F0;">ctime</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Wed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Jul</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">04</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">18</span><span style="color:#9ECBFF;">:49:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2018</span></span>
<span class="line"><span style="color:#B392F0;">mZxid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xd</span></span>
<span class="line"><span style="color:#B392F0;">mtime</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Wed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Jul</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">04</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">18</span><span style="color:#9ECBFF;">:49:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2018</span></span>
<span class="line"><span style="color:#B392F0;">pZxid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0xd</span></span>
<span class="line"><span style="color:#B392F0;">cversion</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">dataVersion</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">aclVersion</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">ephemeralOwner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x0</span></span>
<span class="line"><span style="color:#B392F0;">dataLength</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span></span>
<span class="line"><span style="color:#B392F0;">numChildren</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">31</span><span style="color:#24292E;">] create /orderservice 1</span></span>
<span class="line"><span style="color:#6F42C1;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/orderservice</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">32</span><span style="color:#24292E;">] create /orderservice/wsdl darian</span></span>
<span class="line"><span style="color:#6F42C1;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/orderservice/wsdl</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">33</span><span style="color:#24292E;">] get /orderservice/wsdl</span></span>
<span class="line"><span style="color:#6F42C1;">darian</span></span>
<span class="line"><span style="color:#6F42C1;">cZxid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xd</span></span>
<span class="line"><span style="color:#6F42C1;">ctime</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Wed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Jul</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">04</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">18</span><span style="color:#032F62;">:49:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2018</span></span>
<span class="line"><span style="color:#6F42C1;">mZxid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xd</span></span>
<span class="line"><span style="color:#6F42C1;">mtime</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Wed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Jul</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">04</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">18</span><span style="color:#032F62;">:49:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2018</span></span>
<span class="line"><span style="color:#6F42C1;">pZxid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0xd</span></span>
<span class="line"><span style="color:#6F42C1;">cversion</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">dataVersion</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">aclVersion</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">ephemeralOwner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x0</span></span>
<span class="line"><span style="color:#6F42C1;">dataLength</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span></span>
<span class="line"><span style="color:#6F42C1;">numChildren</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">–s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">–e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">acl</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">-s</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">sequence</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">有序</span></span>
<span class="line"><span style="color:#B392F0;">-e</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">ephemeral</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">临时特性</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">–s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">–e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path</span><span style="color:#24292E;"> </span><span style="color:#032F62;">data</span><span style="color:#24292E;"> </span><span style="color:#032F62;">acl</span><span style="color:#24292E;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">-s</span><span style="color:#24292E;">  </span><span style="color:#032F62;">sequence</span><span style="color:#24292E;">     </span><span style="color:#032F62;">有序</span></span>
<span class="line"><span style="color:#6F42C1;">-e</span><span style="color:#24292E;">  </span><span style="color:#032F62;">ephemeral</span><span style="color:#24292E;">   </span><span style="color:#032F62;">临时特性</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我们可以基于这两个参数去创建我们的节点。</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">–s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/seq</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">–s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/seq</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>自动地都会有一个序号</p><p>有序节点</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">40</span><span style="color:#E1E4E8;">] create -s /seq/ 1</span></span>
<span class="line"><span style="color:#B392F0;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/seq/0000000000</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">41</span><span style="color:#E1E4E8;">] create -s /seq/ 1</span></span>
<span class="line"><span style="color:#B392F0;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/seq/0000000001</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">42</span><span style="color:#E1E4E8;">] create -s /seq/ 1</span></span>
<span class="line"><span style="color:#B392F0;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/seq/0000000002</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">43</span><span style="color:#E1E4E8;">] create -s /seq/ 1</span></span>
<span class="line"><span style="color:#B392F0;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/seq/0000000003</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">44</span><span style="color:#E1E4E8;">] create -s /seq/ 1</span></span>
<span class="line"><span style="color:#B392F0;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/seq/0000000004</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">45</span><span style="color:#E1E4E8;">] create -s /seq/ 1</span></span>
<span class="line"><span style="color:#B392F0;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/seq/0000000005</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">46</span><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">40</span><span style="color:#24292E;">] create -s /seq/ 1</span></span>
<span class="line"><span style="color:#6F42C1;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/seq/0000000000</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">41</span><span style="color:#24292E;">] create -s /seq/ 1</span></span>
<span class="line"><span style="color:#6F42C1;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/seq/0000000001</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">42</span><span style="color:#24292E;">] create -s /seq/ 1</span></span>
<span class="line"><span style="color:#6F42C1;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/seq/0000000002</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">43</span><span style="color:#24292E;">] create -s /seq/ 1</span></span>
<span class="line"><span style="color:#6F42C1;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/seq/0000000003</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">44</span><span style="color:#24292E;">] create -s /seq/ 1</span></span>
<span class="line"><span style="color:#6F42C1;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/seq/0000000004</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">45</span><span style="color:#24292E;">] create -s /seq/ 1</span></span>
<span class="line"><span style="color:#6F42C1;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/seq/0000000005</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">46</span><span style="color:#24292E;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>查看节点</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">46</span><span style="color:#E1E4E8;">] ls /seq</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">0000000001</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0000000000</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0000000003</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0000000002</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0000000005</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">0000000004</span><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">46</span><span style="color:#24292E;">] ls /seq</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">0000000001</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">0000000000</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">0000000003</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">0000000002</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">0000000005</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">0000000004</span><span style="color:#24292E;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="ctrl-c-断开连接" tabindex="-1">Ctrl + c 断开连接 <a class="header-anchor" href="#ctrl-c-断开连接" aria-label="Permalink to &quot;Ctrl + c 断开连接&quot;">​</a></h2><p>再次连接上，临时节点就被删除了</p><p>Key-value形式可以存储序列化的对象。</p><h3 id="节点必须有父节点-才能创建子节点。" tabindex="-1">节点必须有父节点，才能创建子节点。 <a class="header-anchor" href="#节点必须有父节点-才能创建子节点。" aria-label="Permalink to &quot;节点必须有父节点，才能创建子节点。&quot;">​</a></h3><p><code>Zoo_sample.cfg</code> 里边</p><p><code>dataDir=tmp/zookeeper</code> ：存储数据的文件的路径</p><p>zookeeper默认读取 zoo.cfg 文件</p><p><code>zkCli.sh</code> zookeeper自带的客户端脚本</p><p>临时节点下不能有子节点</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">] create -e /tmp 1</span></span>
<span class="line"><span style="color:#B392F0;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">] create /tmp/aaa 3</span></span>
<span class="line"><span style="color:#B392F0;">Ephemerals</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cannot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">have</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">children:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/aaa</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">] create -e /tmp/aaa 3</span></span>
<span class="line"><span style="color:#B392F0;">Ephemerals</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cannot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">have</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">children:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/aaa</span></span>
<span class="line"><span style="color:#E1E4E8;">[zk: localhost:2181(CONNECTED) </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">] create -e /tmp 1</span></span>
<span class="line"><span style="color:#6F42C1;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">] create /tmp/aaa 3</span></span>
<span class="line"><span style="color:#6F42C1;">Ephemerals</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cannot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">have</span><span style="color:#24292E;"> </span><span style="color:#032F62;">children:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/aaa</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">] create -e /tmp/aaa 3</span></span>
<span class="line"><span style="color:#6F42C1;">Ephemerals</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cannot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">have</span><span style="color:#24292E;"> </span><span style="color:#032F62;">children:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/aaa</span></span>
<span class="line"><span style="color:#24292E;">[zk: localhost:2181(CONNECTED) </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h1 id="配置zookeeper集群" tabindex="-1">配置zookeeper集群 <a class="header-anchor" href="#配置zookeeper集群" aria-label="Permalink to &quot;配置zookeeper集群&quot;">​</a></h1><p>可能需要安装vim 插件</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># yum install -y vim </span></span>
<span class="line"><span style="color:#6A737D;"># vim zoo.cfg</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># yum install -y vim </span></span>
<span class="line"><span style="color:#6A737D;"># vim zoo.cfg</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>下边加上</p><p>​ 前边是集群之间通信的接口，后边是用来选举的端口</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">## server.id=ip:port:port</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">server.1</span><span style="color:#E1E4E8;">=192.168.136.128:2888:3888</span></span>
<span class="line"><span style="color:#B392F0;">server.2</span><span style="color:#E1E4E8;">=192.168.136.130:2888:3888</span></span>
<span class="line"><span style="color:#B392F0;">server.3</span><span style="color:#E1E4E8;">=192.168.136.131:2888:3888</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">## server.id=ip:port:port</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">server.1</span><span style="color:#24292E;">=192.168.136.128:2888:3888</span></span>
<span class="line"><span style="color:#6F42C1;">server.2</span><span style="color:#24292E;">=192.168.136.130:2888:3888</span></span>
<span class="line"><span style="color:#6F42C1;">server.3</span><span style="color:#24292E;">=192.168.136.131:2888:3888</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>（启动一次zookeeper才有对应的目录）</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># vim /tmp/zookeeper/myid</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># vim /tmp/zookeeper/myid</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>在data目录下创建myid(id一定要和上面id对应的ip对应)</p><p><code>i</code></p><p>把server的id放进去</p><p>查看进程</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># ps –ef|grep zookeeper</span></span>
<span class="line"><span style="color:#6A737D;"># Kill -9 40290</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># ps –ef|grep zookeeper</span></span>
<span class="line"><span style="color:#6A737D;"># Kill -9 40290</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>直接关掉进程</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># sh zkServer.sh stop</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># sh zkServer.sh stop</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>看一下日志：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># tail –f zookeeper.out</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:52:30,493</span><span style="color:#E1E4E8;"> [myid:1] - INFO [QuorumPeer[myid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]/0:0:0:0:0:0:0:0:2181:QuorumPeer$QuorumServer@184] - Resolved hostname: 192.168.168.131 to address: /192.168.168.131</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:52:30,493</span><span style="color:#E1E4E8;"> [myid:1] - INFO [QuorumPeer[myid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]/0:0:0:0:0:0:0:0:2181:FastLeaderElection@847] - Notification </span><span style="color:#F97583;">time</span><span style="color:#E1E4E8;"> out: 60000</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:53:30,510</span><span style="color:#E1E4E8;"> [myid:1] - WARN [QuorumPeer[myid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]/0:0:0:0:0:0:0:0:2181:QuorumCnxManager@584] - Cannot open channel</span></span>
<span class="line"><span style="color:#B392F0;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">at</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">election</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">address</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/192.168.136.130:3888</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># tail –f zookeeper.out</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:52:30,493</span><span style="color:#24292E;"> [myid:1] - INFO [QuorumPeer[myid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]/0:0:0:0:0:0:0:0:2181:QuorumPeer$QuorumServer@184] - Resolved hostname: 192.168.168.131 to address: /192.168.168.131</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:52:30,493</span><span style="color:#24292E;"> [myid:1] - INFO [QuorumPeer[myid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]/0:0:0:0:0:0:0:0:2181:FastLeaderElection@847] - Notification </span><span style="color:#D73A49;">time</span><span style="color:#24292E;"> out: 60000</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:53:30,510</span><span style="color:#24292E;"> [myid:1] - WARN [QuorumPeer[myid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]/0:0:0:0:0:0:0:0:2181:QuorumCnxManager@584] - Cannot open channel</span></span>
<span class="line"><span style="color:#6F42C1;">to</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">at</span><span style="color:#24292E;"> </span><span style="color:#032F62;">election</span><span style="color:#24292E;"> </span><span style="color:#032F62;">address</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/192.168.136.130:3888</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这个时候会报错</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Cannot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">open</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">channel</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">at</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">election</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">address</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/192.168.111.155:3888</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Cannot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">open</span><span style="color:#24292E;"> </span><span style="color:#032F62;">channel</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">at</span><span style="color:#24292E;"> </span><span style="color:#032F62;">election</span><span style="color:#24292E;"> </span><span style="color:#032F62;">address</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/192.168.111.155:3888</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这个端口是用来做leader选举的</p><p>报错</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Java.net.NoRouteToHoHostExceptoion:No</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">route</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Java.net.NoRouteToHoHostExceptoion:No</span><span style="color:#24292E;"> </span><span style="color:#032F62;">route</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>防火墙没有关</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># systemctl stop firewalld</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># systemctl stop firewalld</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>关闭防火墙</p><p>成功启动了</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:18,440</span><span style="color:#E1E4E8;"> [myid:1] - INFO [LearnerHandler-/192.168.136.131:33468:LearnerHandler@346] - Follower sid: 3 </span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> info </span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> org.apache.zookeeper.server.quorum.QuorumPeer$QuorumServer@30dac10b</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:18,448</span><span style="color:#E1E4E8;"> [myid:1] - INFO [LearnerHandler-/192.168.136.131:33468:LearnerHandler@401] - Synchronizing with Follower sid: 3 maxCommittedLog=0x1b minCommittedLog=0x1 peerLastZxid=0x0</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:18,448</span><span style="color:#E1E4E8;"> [myid:1] - WARN [LearnerHandler-/192.168.136.131:33468:LearnerHandler@468] - Unhandled proposal scenario</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:18,448</span><span style="color:#E1E4E8;"> [myid:1] - INFO [LearnerHandler-/192.168.136.131:33468:LearnerHandler@475] - Sending SNAP</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:18,449</span><span style="color:#E1E4E8;"> [myid:1] - INFO [LearnerHandler-/192.168.136.131:33468:LearnerHandler@499] - Sending snapshot last zxid of peer is 0x0 zxid of leader is 0x100000000sent zxid of db as 0x1b</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:18,457</span><span style="color:#E1E4E8;"> [myid:1] - INFO [LearnerHandler-/192.168.136.131:33468:LearnerHandler@535] - Received NEWLEADER-ACK message from 3</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:18,457</span><span style="color:#E1E4E8;"> [myid:1] - INFO [QuorumPeer[myid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]/0:0:0:0:0:0:0:0:2181:Leader@962] - Have quorum of supporters, sids: [ </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,3 ]; </span><span style="color:#B392F0;">starting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">setting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">last</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">processed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">zxid:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x100000000</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:22,252</span><span style="color:#E1E4E8;"> [myid:1] - INFO [LearnerHandler-/192.168.136.130:50564:LearnerHandler@346] - Follower sid: 2 </span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> info </span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> org.apache.zookeeper.server.quorum.QuorumPeer$QuorumServer@7d15c17f</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:22,261</span><span style="color:#E1E4E8;"> [myid:1] - INFO [LearnerHandler-/192.168.136.130:50564:LearnerHandler@401] - Synchronizing with Follower sid: 2 maxCommittedLog=0x1b minCommittedLog=0x1 peerLastZxid=0x0</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:22,261</span><span style="color:#E1E4E8;"> [myid:1] - WARN [LearnerHandler-/192.168.136.130:50564:LearnerHandler@468] - Unhandled proposal scenario</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:22,261</span><span style="color:#E1E4E8;"> [myid:1] - INFO [LearnerHandler-/192.168.136.130:50564:LearnerHandler@475] - Sending SNAP</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:22,262</span><span style="color:#E1E4E8;"> [myid:1] - INFO [LearnerHandler-</span></span>
<span class="line"><span style="color:#E1E4E8;">/192.168.136.130:50564:LearnerHandler@499] - Sending snapshot last zxid of peer is 0x0 zxid of leader is 0x100000000sent zxid of db as 0x100000000</span></span>
<span class="line"><span style="color:#B392F0;">2018-07-05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#9ECBFF;">:05:22,270</span><span style="color:#E1E4E8;"> [myid:1] - INFO [LearnerHandler-/192.168.136.130:50564:LearnerHandler@535] - Received NEWLEADER-ACK message from 2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:18,440</span><span style="color:#24292E;"> [myid:1] - INFO [LearnerHandler-/192.168.136.131:33468:LearnerHandler@346] - Follower sid: 3 </span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> info </span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> org.apache.zookeeper.server.quorum.QuorumPeer$QuorumServer@30dac10b</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:18,448</span><span style="color:#24292E;"> [myid:1] - INFO [LearnerHandler-/192.168.136.131:33468:LearnerHandler@401] - Synchronizing with Follower sid: 3 maxCommittedLog=0x1b minCommittedLog=0x1 peerLastZxid=0x0</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:18,448</span><span style="color:#24292E;"> [myid:1] - WARN [LearnerHandler-/192.168.136.131:33468:LearnerHandler@468] - Unhandled proposal scenario</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:18,448</span><span style="color:#24292E;"> [myid:1] - INFO [LearnerHandler-/192.168.136.131:33468:LearnerHandler@475] - Sending SNAP</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:18,449</span><span style="color:#24292E;"> [myid:1] - INFO [LearnerHandler-/192.168.136.131:33468:LearnerHandler@499] - Sending snapshot last zxid of peer is 0x0 zxid of leader is 0x100000000sent zxid of db as 0x1b</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:18,457</span><span style="color:#24292E;"> [myid:1] - INFO [LearnerHandler-/192.168.136.131:33468:LearnerHandler@535] - Received NEWLEADER-ACK message from 3</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:18,457</span><span style="color:#24292E;"> [myid:1] - INFO [QuorumPeer[myid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]/0:0:0:0:0:0:0:0:2181:Leader@962] - Have quorum of supporters, sids: [ </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,3 ]; </span><span style="color:#6F42C1;">starting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">up</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">setting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">last</span><span style="color:#24292E;"> </span><span style="color:#032F62;">processed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">zxid:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x100000000</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:22,252</span><span style="color:#24292E;"> [myid:1] - INFO [LearnerHandler-/192.168.136.130:50564:LearnerHandler@346] - Follower sid: 2 </span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> info </span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> org.apache.zookeeper.server.quorum.QuorumPeer$QuorumServer@7d15c17f</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:22,261</span><span style="color:#24292E;"> [myid:1] - INFO [LearnerHandler-/192.168.136.130:50564:LearnerHandler@401] - Synchronizing with Follower sid: 2 maxCommittedLog=0x1b minCommittedLog=0x1 peerLastZxid=0x0</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:22,261</span><span style="color:#24292E;"> [myid:1] - WARN [LearnerHandler-/192.168.136.130:50564:LearnerHandler@468] - Unhandled proposal scenario</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:22,261</span><span style="color:#24292E;"> [myid:1] - INFO [LearnerHandler-/192.168.136.130:50564:LearnerHandler@475] - Sending SNAP</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:22,262</span><span style="color:#24292E;"> [myid:1] - INFO [LearnerHandler-</span></span>
<span class="line"><span style="color:#24292E;">/192.168.136.130:50564:LearnerHandler@499] - Sending snapshot last zxid of peer is 0x0 zxid of leader is 0x100000000sent zxid of db as 0x100000000</span></span>
<span class="line"><span style="color:#6F42C1;">2018-07-05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#032F62;">:05:22,270</span><span style="color:#24292E;"> [myid:1] - INFO [LearnerHandler-/192.168.136.130:50564:LearnerHandler@535] - Received NEWLEADER-ACK message from 2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>查看节点的状态:</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># sh zkServer.sh status</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># sh zkServer.sh status</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@Darian1 bin]# sh zkServer.sh status</span></span>
<span class="line"><span style="color:#B392F0;">ZooKeeper</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">JMX</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enabled</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">Using</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/zookeeper/zookeeper-3.4.12/bin/../conf/zoo.cfg</span></span>
<span class="line"><span style="color:#B392F0;">Mode:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@Darian1 bin]# sh zkServer.sh status</span></span>
<span class="line"><span style="color:#6F42C1;">ZooKeeper</span><span style="color:#24292E;"> </span><span style="color:#032F62;">JMX</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enabled</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">Using</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/zookeeper/zookeeper-3.4.12/bin/../conf/zoo.cfg</span></span>
<span class="line"><span style="color:#6F42C1;">Mode:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Zookeeper</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">JMX</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enabled</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">Using</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/data/program/zookeeper-…….</span></span>
<span class="line"><span style="color:#B392F0;">Mode:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">follower</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Zookeeper</span><span style="color:#24292E;"> </span><span style="color:#032F62;">JMX</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enabled</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">Using</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/data/program/zookeeper-…….</span></span>
<span class="line"><span style="color:#6F42C1;">Mode:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">follower</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>到follower中可以看到数据的同步现象</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># sh zkCli.sh</span></span>
<span class="line"><span style="color:#6A737D;"># ls /</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># sh zkCli.sh</span></span>
<span class="line"><span style="color:#6A737D;"># ls /</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在 data 目录下创建myid（id要和上面的id对应的ip对应）</p><h2 id="observer" tabindex="-1">Observer <a class="header-anchor" href="#observer" aria-label="Permalink to &quot;Observer&quot;">​</a></h2><p>在集群中还有一个Observer的角色</p><p>Observer</p><p>起到一个监控的作用</p><p>在不影响整个集群性能的情况下，还能够知道整个集群的状态</p><h1 id="回顾" tabindex="-1">回顾： <a class="header-anchor" href="#回顾" aria-label="Permalink to &quot;回顾：&quot;">​</a></h1><p><img src="`+u+`" alt="JavaGuide-Zookeeper-初步认识-zookeeper-服务地址-临时节点.png"></p><p>我们希望有一个中间件可以实现我们的服务发现，地址感知，和负载均衡。</p><p>所以有了zookeeper</p><p>我们需要一个注册中心去管理我们的地址，我们的客户端都会调用zookeeper上的地址。</p><p>被调用方在zookeeper上创建节点</p><p>订单服务在zookeeper上创建了一个order节点，（持久化节点）</p><p>然后我们在order节点下可以创建很多个节点，每个节点上存储的是对应的协议地址，可以创建多个。如果此刻这个服务的集群有一千个，那么我需要在这个节点下维护一千个地址。</p><p>我们的协议地址，就需要用临时节点。</p><p>我们前边说要做到服务动态上下线感知。就意味着，服务宕机以后在这个节点上要有体现。这个节点会自动删除。</p><p>临时节点的好处：它的生命周期和当前的会话是保持一致的。</p><p>我们启动以后，通过我们的封装，就是底层的封装，dubbo就是这样封装的。</p><p>调用方，连接zookeeper拿到这个信息，</p><p>叫做订阅：</p><p>订阅：叫做watcher机制</p><p>就是对应节点如果发生变化了，会有一个事件通知。</p><p>节点一旦发生地址的变化，就会有通知。我们就可以拿到相应的数据去做处理。去判断当前节点的状态，或者我们去更新当前节点的信息。就能够拿到我们最新的地址，以及我们拿到地址以后就可以做负载均衡。</p><h3 id="先了解zookeeper的核心" tabindex="-1">先了解zookeeper的核心： <a class="header-anchor" href="#先了解zookeeper的核心" aria-label="Permalink to &quot;先了解zookeeper的核心：&quot;">​</a></h3><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># cd conf/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># cd conf/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>任何中间件里边都有一个配置文件，redis有一个叫redis.cfg</p><p>Zookeeper有一个叫 <code>zoo.cfg</code></p><p>Nginx有一个配置文件叫 <code>nginx.cfg</code></p><p>因为中间件需要提供一些需要优化的配置，我们可以去调整我们的线程、缓冲区，去配置我们的相关地址。</p><p>详细配置去官网上看，可以根据需要去做很多的调整</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">TickTime-2000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">它可以理解成一个时间单位，是我们zookeeper里边最小的时间单位毫秒。</span></span>
<span class="line"><span style="color:#B392F0;">每2毫秒：相当于我们定义</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">了一个时间单位的规则。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">TickTime-2000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">它可以理解成一个时间单位，是我们zookeeper里边最小的时间单位毫秒。</span></span>
<span class="line"><span style="color:#6F42C1;">每2毫秒：相当于我们定义</span><span style="color:#24292E;"> </span><span style="color:#032F62;">了一个时间单位的规则。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">initLImit</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">初始化，就是初始化同步数据的时候</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">，10表示10个tickTime</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">initLImit</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">初始化，就是初始化同步数据的时候</span><span style="color:#24292E;">  </span><span style="color:#032F62;">，10表示10个tickTime</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>最大的同步时间、初始化时间。</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">syncLimit</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">5</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">syncLimit</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">5</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>发起一个请求，和获得请求的状态的一个时间，就是数据同步的时间</p><p>这是leader和follower之间的心跳检测最大延迟，是5个tickTime ，就是10秒钟。</p><p>如果集群中我们的follower节点不可用，或者我们的leader节点不可用，这时候这样的一个心跳检测就会出现一个故障，如果心跳出现一个故障，就意味着整个集群中出现某个节点不可用，就会重新去选举</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">dataDir</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">/tmp/zookeeper</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">dataDir</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">/tmp/zookeeper</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这是大家关注的。</p><p>我们对应的事务的日志文件会存在dataDir文件里边，</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@Darian1 conf]# ls /tmp/zookeeper/version-2/</span></span>
<span class="line"><span style="color:#B392F0;">acceptedEpoch</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">currentEpoch</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">log.1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">log.100000001</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">log.200000001</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@Darian1 conf]# ls /tmp/zookeeper/version-2/</span></span>
<span class="line"><span style="color:#6F42C1;">acceptedEpoch</span><span style="color:#24292E;"> </span><span style="color:#032F62;">currentEpoch</span><span style="color:#24292E;"> </span><span style="color:#032F62;">log.1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">log.100000001</span><span style="color:#24292E;"> </span><span style="color:#032F62;">log.200000001</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Tmp是一个临时节点，所以我们不建议放在这个目录下，我们建议独立挂载在一个SSD的高速磁盘上，因为磁盘的读取速度决定了我们zookeeper集群的一个性能，因为我们的每一个事务请求，就是我们的每一个insert，update 和 delete，是属于事务请求，那么每一个事务请求，它都会先去记录事务日志，所以记录日志这个盘写入比较慢，那么这个整体的性能就会受到很大的影响。</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">clientPort</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">2181</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">clientPort</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">2181</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>客户端和服务端连接的时候用到的一个端口</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">redis:6379</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">tomcat</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8080</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">redis:6379</span><span style="color:#24292E;">  </span><span style="color:#032F62;">tomcat</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8080</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这是一个对外提供的一个开放的端口</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Server.1</span><span style="color:#E1E4E8;">=192.168.11.153:2888:3888</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Server.1</span><span style="color:#24292E;">=192.168.11.153:2888:3888</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>后边对应的是myid myid是默认找到dataDir里边的一个myid文件，去读取这个id。</p><p>这个id后边会用</p><p>这个myid对应的ip地址，通信端口号，选举端口</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># ls /tmp/zookeeper/version-2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># ls /tmp/zookeeper/version-2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>可以看到</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">AcceptedEpoch</span></span>
<span class="line"><span style="color:#B392F0;">currentEpoh</span></span>
<span class="line"><span style="color:#B392F0;">log.1</span></span>
<span class="line"><span style="color:#B392F0;">log.3</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">AcceptedEpoch</span></span>
<span class="line"><span style="color:#6F42C1;">currentEpoh</span></span>
<span class="line"><span style="color:#6F42C1;">log.1</span></span>
<span class="line"><span style="color:#6F42C1;">log.3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="策略" tabindex="-1">策略 <a class="header-anchor" href="#策略" aria-label="Permalink to &quot;策略&quot;">​</a></h3><p>打开我们的zookeeper客户端</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># sh zkCli.sh </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ls /</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># sh zkCli.sh </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ls /</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>可以看到节点</p><p>我们用到了很多命令，并做了一些简单的策略，比如说临时节点策略和持久节点策略</p><p>（m 修改 modifier 修改）</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#&gt; get /zzz</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#&gt; get /zzz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>去获取一个节点的话可以获得很多信息</p><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[zk: localhost:</span><span style="color:#79B8FF;">2181</span><span style="color:#E1E4E8;">(CONNECTED) </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">] get </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">seq</span></span>
<span class="line"><span style="color:#E1E4E8;">seq</span></span>
<span class="line"><span style="color:#E1E4E8;">cZxid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">0x</span><span style="color:#79B8FF;">f</span></span>
<span class="line"><span style="color:#E1E4E8;">ctime </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Wed Jul </span><span style="color:#F97583;">0</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">19</span><span style="color:#E1E4E8;">:</span><span style="color:#F97583;">0</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;"> CST </span><span style="color:#79B8FF;">2018</span></span>
<span class="line"><span style="color:#E1E4E8;">mZxid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">0x</span><span style="color:#79B8FF;">f</span></span>
<span class="line"><span style="color:#E1E4E8;">mtime </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Wed Jul </span><span style="color:#F97583;">0</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">19</span><span style="color:#E1E4E8;">:</span><span style="color:#F97583;">0</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;"> CST </span><span style="color:#79B8FF;">2018</span></span>
<span class="line"><span style="color:#E1E4E8;">pZxid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">0x</span><span style="color:#79B8FF;">15</span></span>
<span class="line"><span style="color:#E1E4E8;">cversion </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span></span>
<span class="line"><span style="color:#E1E4E8;">dataVersion </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">aclVersion </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">ephemeralOwner </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">0x</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">dataLength </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">numChildren </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[zk: localhost:</span><span style="color:#005CC5;">2181</span><span style="color:#24292E;">(CONNECTED) </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">] get </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">seq</span></span>
<span class="line"><span style="color:#24292E;">seq</span></span>
<span class="line"><span style="color:#24292E;">cZxid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">0x</span><span style="color:#005CC5;">f</span></span>
<span class="line"><span style="color:#24292E;">ctime </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Wed Jul </span><span style="color:#D73A49;">0</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">19</span><span style="color:#24292E;">:</span><span style="color:#D73A49;">0</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">16</span><span style="color:#24292E;"> CST </span><span style="color:#005CC5;">2018</span></span>
<span class="line"><span style="color:#24292E;">mZxid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">0x</span><span style="color:#005CC5;">f</span></span>
<span class="line"><span style="color:#24292E;">mtime </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Wed Jul </span><span style="color:#D73A49;">0</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">19</span><span style="color:#24292E;">:</span><span style="color:#D73A49;">0</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">16</span><span style="color:#24292E;"> CST </span><span style="color:#005CC5;">2018</span></span>
<span class="line"><span style="color:#24292E;">pZxid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">0x</span><span style="color:#005CC5;">15</span></span>
<span class="line"><span style="color:#24292E;">cversion </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span></span>
<span class="line"><span style="color:#24292E;">dataVersion </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">aclVersion </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">ephemeralOwner </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">0x</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">dataLength </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">numChildren </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>value值</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">cZxiid</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">0x1000000000003</span><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#B392F0;">表示事务id，我们去创建一个节点的时候相当于发起一个事务请求，他会有个事务id</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">cZxiid</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">0x1000000000003</span><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#6F42C1;">表示事务id，我们去创建一个节点的时候相当于发起一个事务请求，他会有个事务id</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ctime</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">Sun</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">03</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">21</span><span style="color:#9ECBFF;">:08:21</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2019</span></span>
<span class="line"><span style="color:#B392F0;">创建时间</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ctime</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">Sun</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">03</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">:08:21</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2019</span></span>
<span class="line"><span style="color:#6F42C1;">创建时间</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">mZxid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x100000000000003</span></span>
<span class="line"><span style="color:#B392F0;">我们对节点进行更改的时候，进行更新事务，就会有更新事务id，如果我们在创建了节点以后他的创建id和更新id是一样的。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">mZxid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x100000000000003</span></span>
<span class="line"><span style="color:#6F42C1;">我们对节点进行更改的时候，进行更新事务，就会有更新事务id，如果我们在创建了节点以后他的创建id和更新id是一样的。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">mtime</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Sun</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">03</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">21</span><span style="color:#9ECBFF;">:08:21</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2019</span></span>
<span class="line"><span style="color:#B392F0;">修改时间</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">mtime</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Sun</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">03</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">:08:21</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2019</span></span>
<span class="line"><span style="color:#6F42C1;">修改时间</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">pZxid</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0x1000000000003</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">这个表示当前节点下，最后一次被修改的时候，他的一个事务id，会放到pZxid里边。</span></span>
<span class="line"><span style="color:#B392F0;">只有子节点变更以后才会产生pZxid的影响</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">pZxid</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0x1000000000003</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">这个表示当前节点下，最后一次被修改的时候，他的一个事务id，会放到pZxid里边。</span></span>
<span class="line"><span style="color:#6F42C1;">只有子节点变更以后才会产生pZxid的影响</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">cversion</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">当前节点的子节点版本号</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">cversion</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">当前节点的子节点版本号</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">dataVersion</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">当前数据内容它的版本号</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">dataVersion</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">当前数据内容它的版本号</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">aclVersion</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">当前权限变更的版本号</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">aclVersion</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">当前权限变更的版本号</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这时候有一个version，它是一个乐观锁的概念，我们会通过一个版本号去维护数据的版本。如果说我们a、b同时去修改一个数据，这个数据修改以后它的版本发生了变化，a先，b后的话，b基于以前的数据进行修改的话，得到的数据不对，这就是我们乐观锁的概念。通过版本号去维护数据的状态。</p><p>这些版本号用来控制数据的并发性，因为zookeeper一定存在并发访问。记录版本号，是为了防止对脏数据的一个修改导致最终数据不一致，所以我们在修改的时候需要一个版本号。</p><p>（我们在更新节点的时候传入一个版本号 <code>set /zzz value 0</code> ，这时候 <code>dataaVersion=1</code>，我们在 <code>set /zzz value 0</code>，这个时候它会报错，version No is not valid : /mic 这就是我们用版本号去控制被错误修改的一个重要的手段）</p><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[zk: localhost:</span><span style="color:#79B8FF;">2181</span><span style="color:#E1E4E8;">(CONNECTED) </span><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;">] set </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">seq aa </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">    cZxid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">0x</span><span style="color:#79B8FF;">f</span></span>
<span class="line"><span style="color:#E1E4E8;">    ctime </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Wed Jul </span><span style="color:#F97583;">0</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">19</span><span style="color:#E1E4E8;">:</span><span style="color:#F97583;">0</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;"> CST </span><span style="color:#79B8FF;">2018</span></span>
<span class="line"><span style="color:#E1E4E8;">        mZxid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">0x</span><span style="color:#79B8FF;">200000003</span></span>
<span class="line"><span style="color:#E1E4E8;">        mtime </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Thu Jul </span><span style="color:#F97583;">0</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">54</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">53</span><span style="color:#E1E4E8;"> CST </span><span style="color:#79B8FF;">2018</span></span>
<span class="line"><span style="color:#E1E4E8;">            pZxid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">0x</span><span style="color:#79B8FF;">15</span></span>
<span class="line"><span style="color:#E1E4E8;">            cversion </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span></span>
<span class="line"><span style="color:#E1E4E8;">            dataVersion </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">            aclVersion </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">            ephemeralOwner </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">0x</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">            dataLength </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">            numChildren </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span></span>
<span class="line"><span style="color:#E1E4E8;">            [zk: localhost:</span><span style="color:#79B8FF;">2181</span><span style="color:#E1E4E8;">(CONNECTED) </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">] set </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">seq aa </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">            version No is not valid : </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">seq</span></span>
<span class="line"><span style="color:#E1E4E8;">    [zk: localhost:</span><span style="color:#79B8FF;">2181</span><span style="color:#E1E4E8;">(CONNECTED) </span><span style="color:#79B8FF;">9</span><span style="color:#E1E4E8;">] set </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">seq bb </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">                cZxid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">0x</span><span style="color:#79B8FF;">f</span></span>
<span class="line"><span style="color:#E1E4E8;">                ctime </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Wed Jul </span><span style="color:#F97583;">0</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">19</span><span style="color:#E1E4E8;">:</span><span style="color:#F97583;">0</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;"> CST </span><span style="color:#79B8FF;">2018</span></span>
<span class="line"><span style="color:#E1E4E8;">                    mZxid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">0x</span><span style="color:#79B8FF;">200000005</span></span>
<span class="line"><span style="color:#E1E4E8;">                    mtime </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Thu Jul </span><span style="color:#F97583;">0</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">56</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">21</span><span style="color:#E1E4E8;"> CST </span><span style="color:#79B8FF;">2018</span></span>
<span class="line"><span style="color:#E1E4E8;">                        pZxid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">0x</span><span style="color:#79B8FF;">15</span></span>
<span class="line"><span style="color:#E1E4E8;">                        cversion </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span></span>
<span class="line"><span style="color:#E1E4E8;">                        dataVersion </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">                        aclVersion </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">                        ephemeralOwner </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">0x</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">                        dataLength </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">                        numChildren </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span></span>
<span class="line"><span style="color:#E1E4E8;">                        [zk: localhost:</span><span style="color:#79B8FF;">2181</span><span style="color:#E1E4E8;">(CONNECTED) </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[zk: localhost:</span><span style="color:#005CC5;">2181</span><span style="color:#24292E;">(CONNECTED) </span><span style="color:#005CC5;">7</span><span style="color:#24292E;">] set </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">seq aa </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    cZxid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">0x</span><span style="color:#005CC5;">f</span></span>
<span class="line"><span style="color:#24292E;">    ctime </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Wed Jul </span><span style="color:#D73A49;">0</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">19</span><span style="color:#24292E;">:</span><span style="color:#D73A49;">0</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">16</span><span style="color:#24292E;"> CST </span><span style="color:#005CC5;">2018</span></span>
<span class="line"><span style="color:#24292E;">        mZxid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">0x</span><span style="color:#005CC5;">200000003</span></span>
<span class="line"><span style="color:#24292E;">        mtime </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Thu Jul </span><span style="color:#D73A49;">0</span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">54</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">53</span><span style="color:#24292E;"> CST </span><span style="color:#005CC5;">2018</span></span>
<span class="line"><span style="color:#24292E;">            pZxid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">0x</span><span style="color:#005CC5;">15</span></span>
<span class="line"><span style="color:#24292E;">            cversion </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span></span>
<span class="line"><span style="color:#24292E;">            dataVersion </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">            aclVersion </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">            ephemeralOwner </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">0x</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">            dataLength </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">            numChildren </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span></span>
<span class="line"><span style="color:#24292E;">            [zk: localhost:</span><span style="color:#005CC5;">2181</span><span style="color:#24292E;">(CONNECTED) </span><span style="color:#005CC5;">8</span><span style="color:#24292E;">] set </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">seq aa </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">            version No is not valid : </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">seq</span></span>
<span class="line"><span style="color:#24292E;">    [zk: localhost:</span><span style="color:#005CC5;">2181</span><span style="color:#24292E;">(CONNECTED) </span><span style="color:#005CC5;">9</span><span style="color:#24292E;">] set </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">seq bb </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">                cZxid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">0x</span><span style="color:#005CC5;">f</span></span>
<span class="line"><span style="color:#24292E;">                ctime </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Wed Jul </span><span style="color:#D73A49;">0</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">19</span><span style="color:#24292E;">:</span><span style="color:#D73A49;">0</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">16</span><span style="color:#24292E;"> CST </span><span style="color:#005CC5;">2018</span></span>
<span class="line"><span style="color:#24292E;">                    mZxid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">0x</span><span style="color:#005CC5;">200000005</span></span>
<span class="line"><span style="color:#24292E;">                    mtime </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Thu Jul </span><span style="color:#D73A49;">0</span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">56</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">21</span><span style="color:#24292E;"> CST </span><span style="color:#005CC5;">2018</span></span>
<span class="line"><span style="color:#24292E;">                        pZxid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">0x</span><span style="color:#005CC5;">15</span></span>
<span class="line"><span style="color:#24292E;">                        cversion </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span></span>
<span class="line"><span style="color:#24292E;">                        dataVersion </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">                        aclVersion </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">                        ephemeralOwner </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">0x</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">                        dataLength </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">                        numChildren </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span></span>
<span class="line"><span style="color:#24292E;">                        [zk: localhost:</span><span style="color:#005CC5;">2181</span><span style="color:#24292E;">(CONNECTED) </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ephemeralOwner</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0X0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ephemeralOwner</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0X0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>创建临时节点以后才会有的， 我们创建一个临时节点之后，get /temp之后</p><p>这个客户端与zookeeper会有一个会话的标志，通过这个标志，我们可以知道这个连接断开以后我们应该把那些临时节点都删掉，这个就是用来绑定当前会话的信息</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">dataLength</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#B392F0;">当前数据的长度</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">dataLength</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#6F42C1;">当前数据的长度</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">numChildren</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">当前子节点的一个数量</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">numChildren</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">当前子节点的一个数量</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">每一个滴答声的毫秒数</span></span>
<span class="line"><span style="color:#B392F0;">tickTime</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2000</span></span>
<span class="line"><span style="color:#B392F0;">最初的蜱虫数量</span></span>
<span class="line"><span style="color:#B392F0;">同步阶段可以</span></span>
<span class="line"><span style="color:#B392F0;">initLimit</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#B392F0;">可以在两者之间传递的节拍数</span></span>
<span class="line"><span style="color:#B392F0;">发送请求并获得确认</span></span>
<span class="line"><span style="color:#B392F0;">syncLimit</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span></span>
<span class="line"><span style="color:#B392F0;">存储快照的目录。</span></span>
<span class="line"><span style="color:#B392F0;">不要使用/tmp存储，/tmp只是</span></span>
<span class="line"><span style="color:#6A737D;">#例子的缘故。</span></span>
<span class="line"><span style="color:#B392F0;">dataDir</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tmp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/动物园管理员</span></span>
<span class="line"><span style="color:#B392F0;">客户端连接的端口</span></span>
<span class="line"><span style="color:#B392F0;">clientPort</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2181</span></span>
<span class="line"><span style="color:#B392F0;">客户端连接的最大数量。</span></span>
<span class="line"><span style="color:#B392F0;">如果你需要处理更多的客户，就增加这个</span></span>
<span class="line"><span style="color:#6A737D;"># maxClientCnxns = 60</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#B392F0;">请务必阅读以下内容的维护部分</span></span>
<span class="line"><span style="color:#B392F0;">管理员指南，在开启自动提醒之前。</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html sc_maintenance</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#B392F0;">在dataDir中保存的快照数量</span></span>
<span class="line"><span style="color:#6A737D;"># autopurge.snapRetainCount = 3</span></span>
<span class="line"><span style="color:#B392F0;">在小时内清除任务间隔</span></span>
<span class="line"><span style="color:#B392F0;">设置为“0”以禁用自动清除功能</span></span>
<span class="line"><span style="color:#6A737D;"># autopurge.purgeInterval = 1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">每一个滴答声的毫秒数</span></span>
<span class="line"><span style="color:#6F42C1;">tickTime</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2000</span></span>
<span class="line"><span style="color:#6F42C1;">最初的蜱虫数量</span></span>
<span class="line"><span style="color:#6F42C1;">同步阶段可以</span></span>
<span class="line"><span style="color:#6F42C1;">initLimit</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#6F42C1;">可以在两者之间传递的节拍数</span></span>
<span class="line"><span style="color:#6F42C1;">发送请求并获得确认</span></span>
<span class="line"><span style="color:#6F42C1;">syncLimit</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span></span>
<span class="line"><span style="color:#6F42C1;">存储快照的目录。</span></span>
<span class="line"><span style="color:#6F42C1;">不要使用/tmp存储，/tmp只是</span></span>
<span class="line"><span style="color:#6A737D;">#例子的缘故。</span></span>
<span class="line"><span style="color:#6F42C1;">dataDir</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tmp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/动物园管理员</span></span>
<span class="line"><span style="color:#6F42C1;">客户端连接的端口</span></span>
<span class="line"><span style="color:#6F42C1;">clientPort</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2181</span></span>
<span class="line"><span style="color:#6F42C1;">客户端连接的最大数量。</span></span>
<span class="line"><span style="color:#6F42C1;">如果你需要处理更多的客户，就增加这个</span></span>
<span class="line"><span style="color:#6A737D;"># maxClientCnxns = 60</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6F42C1;">请务必阅读以下内容的维护部分</span></span>
<span class="line"><span style="color:#6F42C1;">管理员指南，在开启自动提醒之前。</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html sc_maintenance</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6F42C1;">在dataDir中保存的快照数量</span></span>
<span class="line"><span style="color:#6A737D;"># autopurge.snapRetainCount = 3</span></span>
<span class="line"><span style="color:#6F42C1;">在小时内清除任务间隔</span></span>
<span class="line"><span style="color:#6F42C1;">设置为“0”以禁用自动清除功能</span></span>
<span class="line"><span style="color:#6A737D;"># autopurge.purgeInterval = 1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="acl" tabindex="-1">ACL <a class="header-anchor" href="#acl" aria-label="Permalink to &quot;ACL&quot;">​</a></h2><p>ACL是一个权限控制</p><p>Zookeeper提供了一种类似于linux的文件控制权限的一种方式。去控制你创建的文件夹的访问权限。比如说我们创建了某一个节点，只能读，或只能让某一个用户访问怎么办。就是通过ACL去控制。</p><p>ACL定义了五种权限。</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">CREATE/READ/WRITE/DELETE/ADMIN</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">CREATE/READ/WRITE/DELETE/ADMIN</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>每一权限控制的粒度不一样，控制的方向不一样，这就是我们节点的一个特性。</p><h1 id="名词复盘" tabindex="-1">名词复盘： <a class="header-anchor" href="#名词复盘" aria-label="Permalink to &quot;名词复盘：&quot;">​</a></h1><h3 id="集群角色" tabindex="-1">集群角色 <a class="header-anchor" href="#集群角色" aria-label="Permalink to &quot;集群角色&quot;">​</a></h3><p>我们集群中有leader follower，各个集群之间是可以通信的。</p><p><img src="`+b+`" alt="JavaGuide-Zookeeper-初步认识-zookeeper-Leader-Follower集群.png"></p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">                 </span><span style="color:#B392F0;">Leader</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Follower</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">follower</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">observer</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">                 </span><span style="color:#6F42C1;">Leader</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Follower</span><span style="color:#24292E;">           </span><span style="color:#032F62;">follower</span><span style="color:#24292E;">             </span><span style="color:#032F62;">observer</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Leader是用来处理事务请求的，所有的添加，修改，删除，可以理解为一个读写分离的概念。</p><p>如果我们客户端将事务请求发给了follower，那么这个follower会把请求转发给leader</p><p>数据库请求默认都会打开一个事务。Observer是一个监视，Observer只负责去leader节点同步数据，不会参与这个节点的选举，不涉及选举，就不会有性能的开销。它的数据的同步就不需要做到一个实时。Observer节点是可以去配置的。</p><h3 id="数据模型" tabindex="-1">数据模型： <a class="header-anchor" href="#数据模型" aria-label="Permalink to &quot;数据模型：&quot;">​</a></h3><p>Zookeeper核心的东西</p><p>我们可以创建多个节点，</p><p>每个节点下我们又可以创建多个节点。</p><p>节点：</p><ul><li>持久化节点</li><li>持久化有序节点</li><li>临时节点</li><li>临时有序节点</li><li>统计节点的唯一性</li></ul><p><img src="`+F+'" alt="JavaGuide-Zookeeper-初步认识-zookeeper-节点特性.png"></p><p>每一个节点叫做znode，表示他的最小的一个数据单位的名称叫做znode。</p><p>Znode上可以保存少量的数据，不建议保存太多。因为如果你一个节点的数据量很大，那么同步的性能就会很低，第二个，你如果要获得这样一个节点信息，需要通过网络的传输。那么如果数据包比较大，那它就会比较慢。</p><h2 id="会话" tabindex="-1">会话： <a class="header-anchor" href="#会话" aria-label="Permalink to &quot;会话：&quot;">​</a></h2><p>会话是个概念，就是客户端与服务端进行一次连接时，就会产生一次会话。</p><p>就像我们创建一个数据库的连接，建立一个connection，创建一个redis的连接，会建立一个redis-connection，这就是一个连接。这样的连接底层就是一个TCP连接。</p><p>那么连接的状态有几种，它是变化的。</p><p><img src="'+C+'" alt="JavaGuide-Zookeeper-初步认识-zookeeper-会话状态.png"></p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>首先是没有连接的状态</td><td>NOT CONNECTED</td><td>默认状态</td></tr><tr><td>然后发起连接</td><td>CONNECTING</td><td>客户端去初始化连接的时候</td></tr><tr><td>然后客户端连接成功以后</td><td>CONNECTED</td><td>就是连接成功的一个状态</td></tr><tr><td>最后处理完成以后</td><td>CLOSE</td><td></td></tr></tbody></table><p>这是一个会话的生命周期</p><p>Connected也有可能变成connecting，客户端丢失连接的时候，然后他就会去重试连接。然后他重试连接的时间是可以在zoo.cfg中去配置的。如果一直连接不上，就会变成close的状态。主动关闭这个连接，会话失效。</p><p>这是zookeeper里边会话状态的一个改变。</p><h2 id="status" tabindex="-1">Status <a class="header-anchor" href="#status" aria-label="Permalink to &quot;Status&quot;">​</a></h2><p>节点的属性，前边有！！！</p><h2 id="watcher机制" tabindex="-1">Watcher机制 <a class="header-anchor" href="#watcher机制" aria-label="Permalink to &quot;Watcher机制&quot;">​</a></h2><p><img src="'+m+'" alt="JavaGuide-Zookeeper-初步认识-zookeeper-Watcher机制.png"></p><p>我们客户端可以去监听某一个节点，可以去watcher某一个节点。</p><p>客户端watcher这个节点以后，意味着接下来这个节点下的数据的变更，它会有个事件通知。类似于分布式系统的发布订阅，这就是一个事件的通知。我们的客户端就可以被动地知道服务器端的协议信息的状态以及我们节点变更以后更新的一个操作。</p><h2 id="acl权限控制" tabindex="-1">ACL权限控制 <a class="header-anchor" href="#acl权限控制" aria-label="Permalink to &quot;ACL权限控制&quot;">​</a></h2><p>上边有！</p><h1 id="zookeeper的应用场景" tabindex="-1">Zookeeper的应用场景： <a class="header-anchor" href="#zookeeper的应用场景" aria-label="Permalink to &quot;Zookeeper的应用场景：&quot;">​</a></h1><p>Zookeeper可以实现注册中心，通过注册中心拿到一些对应的信息。这是zookeeper第一个特性。</p><h2 id="配置中心" tabindex="-1">配置中心 <a class="header-anchor" href="#配置中心" aria-label="Permalink to &quot;配置中心&quot;">​</a></h2><p><img src="'+v+'" alt="JavaGuide-Zookeeper-初步认识-zookeeper-作为配置中心.png"></p><p>我们还可以实现配置中心。他们实现起来有点大同小异，但在实际使用过程中是不一样的。</p><p>我们开发程序时都会存在一个总的配置文件：比如说 <code>application.context</code>，<code>application.properties</code> 这样一个文件。</p><p>这样的文件会维护在每一个对应的项目里边，比如说我们存在一些数据库的配置，一些常量的配置。我们都放在配置文件里边，后续修改起来很麻烦，第二个维护起来工作量大。</p><p>第三个在于我们的开关，怎么去做。比如说我们要去控制流程的走向。我们通过一个开关的方式去控制，那如果我们现在要将整个工程变成另外一个方向去走的话。</p><p>比如说我们if 走 A if 走B else 走C，</p><p>然后我们现在需要流程变化了，我们需要去重新更改配置文件，去发布，读取配置文件，或者也可以去动态监控这个配置文件。实现起来很麻烦。</p><p>如果这个开关需要同步给多个节点，我们就需要在每个节点去实现这样的一个功能。所以我们就需要一个配置中心来统一的维护，可以在上边托管的一些配置。客户端要访问，我要去配置中心去拿到这个值。你在配置中心配置一个switch，配置中心告诉你的value是这个switch=on。我拿到这个值就可以去判断，这样子就是一个配置中心的一个概念。</p><h3 id="那么zookeeper实现配置中心有两个好处" tabindex="-1">那么zookeeper实现配置中心有两个好处 <a class="header-anchor" href="#那么zookeeper实现配置中心有两个好处" aria-label="Permalink to &quot;那么zookeeper实现配置中心有两个好处&quot;">​</a></h3><p>第一个，我们可以去监听某个节点的变化，可以去watcher，我就可以不需要主动地去拿，然后动态地去感知，动态地push过来。 这是第一个。</p><p>第二个，zookeeper它里边本身的一个节点的特性，就是我们可以通过节点去管理我们相应的一些相关的数据，还有它本身提供了安全机制。</p><p>第三个，我们可以去对节点做一个安全方式的处理，</p><p>所以这是zookeeper能够实现配置中心的好处，还有zookeeper的性能也很高。</p><h2 id="zookeeper-可以实现负载均衡" tabindex="-1">Zookeeper 可以实现负载均衡 <a class="header-anchor" href="#zookeeper-可以实现负载均衡" aria-label="Permalink to &quot;Zookeeper 可以实现负载均衡&quot;">​</a></h2><p><img src="'+g+`" alt="JavaGuide-Zookeeper-初步认识-zookeeper-负载均衡.png"></p><p>负载均衡有两点：</p><ol><li><pre><code> 第一个我要知道机器的状态
</code></pre></li><li><pre><code> 选举master
</code></pre></li></ol><p>我们选举master和zookeeper的leader的选举有什么区别？</p><p>我们可以去基于zookeeper去实现leader选举，比如说kafka是基于zookeeper去实现的，比如说我现在要建立一个kafka集群，有三个节点，怎么实现集群？当然kafka集群不是内部去实现的，zookeeper内部是通过leader选举通过ZAB协议进行选举的，这是它内部提供的机制，但其他的中间件没有。</p><p>Kafka是基于zookeeper，在zookeeper上去注册节点</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Kafka01</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">kafka02</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">kafka03</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Kafka01</span><span style="color:#24292E;">    </span><span style="color:#032F62;">kafka02</span><span style="color:#24292E;">      </span><span style="color:#032F62;">kafka03</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>那我们每一个kafka启动的时候都往zookeeper上去注册一个节点，同一个节点下，节点最小就是leader</p><p>这样子我们就用zookeeper的机制去完成对kafka集群的选举，</p><p>如果对应kafka集群的leader节点挂掉了，这时候zookeeper有一个事件，事件可以通知给其他的节点。当前这个leader节点挂掉了（watcher）。拿到这个通知以后，又要重新地进行选举，然后再拿到最小的节点 kafka2 拿到，把它定义成为master。</p><p>这是zookeeper实现负载均衡的概念</p><p>是基于zookeeper的提醒去实现其他节点的一个功能与管理</p><p>所以说zookeeper是一个分布式协调服务，</p><p>所以它能够协调很多服务的特性</p><h2 id="zookeeper还可以实现分布式锁" tabindex="-1">Zookeeper还可以实现分布式锁 <a class="header-anchor" href="#zookeeper还可以实现分布式锁" aria-label="Permalink to &quot;Zookeeper还可以实现分布式锁&quot;">​</a></h2><p>Watcher机制的演示</p><p>连接上zookeeper客户端以后</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Get /zzz   true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Get /zzz   true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>表示这个节点变化以后会有事件通知</p><p>然后连上另一个客户端，</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Set /zzz    true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Set /zzz    true</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>在get的那个客户端中就会看到一个提醒：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">WATCHER::</span></span>
<span class="line"><span style="color:#B392F0;">WatchedEvent</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">state:SyncConnected</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type:NodeDataChanged</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">path:/mic</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">WATCHER::</span></span>
<span class="line"><span style="color:#6F42C1;">WatchedEvent</span><span style="color:#24292E;"> </span><span style="color:#032F62;">state:SyncConnected</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type:NodeDataChanged</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path:/mic</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>我们在zookeeper上通过它的节点的特性，是一个文件结构的方式，创建节点会有一个结点的顺序，那我们可以通过客户端去访问节点的时候，去创建节点，最小的节点就是leader，基于zookeeper去实现选举</p><h2 id="乐观锁" tabindex="-1">乐观锁： <a class="header-anchor" href="#乐观锁" aria-label="Permalink to &quot;乐观锁：&quot;">​</a></h2><p>每一个数据都存在一个版本号。</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> Get /mic</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> Get /mic</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>可以得到一个版本号 当前是一个3</p><p>然后另一个设置一下</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">   set /mic 3</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   set /mic 3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>版本号为4</p><p>但是我们</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">   set /mic  bbb  3</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   set /mic  bbb  3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这时候我们传递之前的一个版本号，</p><p>他会报错</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">No</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">valid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/mic</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">version</span><span style="color:#24292E;"> </span><span style="color:#032F62;">No</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">valid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mic</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>数据版本号的变化是通过乐观锁去实现的</p><p>Zookeeper的选举有三种方式</p><p>创建节点的时候会直接存在磁盘里，有事务日志</p><p>前边的端口是用来做数据同步的，</p><p>后边的端口是用来做leader选举时用的，</p><p>​ Leader的选举（当服务初步起来的时候，或者leader挂掉的时候就会进行leader的选举）</p><h2 id="observer-1" tabindex="-1">Observer <a class="header-anchor" href="#observer-1" aria-label="Permalink to &quot;Observer&quot;">​</a></h2><p>Observer在不影响zookeeper的写性能的情况下，zookeeper在leader上执行一个写操作，同步给其他的节点，访问量越来越大以后，我们的整个集群就会很大，我们增加一个节点，会增加一些吞吐量，但是也会带来数据同步的性能上的问题。Zookeeper集群整体写的性能就会下降，所以zookeeper里边节点变更数据过来以后，我需要半数的投票以后，才能够告诉客户端已经存储了，这个时候就涉及到数据的同步，observer加到里边，不会参与到投票，所以observer可以提升性能。</p><p>Observer涉及选举，不参与投票</p><p>我们的key-value 的value一般不存什么内容，就基于节点的特性去实现</p><p>日志上不显示哪一台是leader，只能通过状态去显示哪一个是leader</p><p>用kafka必须安装zookeeper</p>`,397),B=[A];function z(D,f,N,x,J,q){return a(),n("div",null,B)}const I=s(k,[["render",z]]);export{S as __pageData,I as default};
