<!DOCTYPE html>
<html lang="zh-cmn-Hans" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>并发的框架 | JavaGuide |  JavaGuide.net </title>
    <meta name="description" content="「JavaGuide.net」一份涵盖大部分 Java 程序员所需要掌握的核心知识。准备 Java 面试，首选 JavaGuide.net ！">
    <link rel="preload stylesheet" href="/assets/style.17ebd446.css" as="style">
    
    <script type="module" src="/assets/app.c5c715c5.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.da611722.js">
    <link rel="modulepreload" href="/assets/chunks/theme.1f181030.js">
    <link rel="modulepreload" href="/assets/chunks/NoGeekProduct.vue_vue_type_script_setup_true_lang.efe5c3cb.js">
    <link rel="modulepreload" href="/assets/百万架构师_并发编程_并发的框架.md.264cb848.lean.js">
    <link rel="manifest" href="/pwa/manifest.json">
    <link rel="icon" href="/favicon.ico">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-098FQBQYET"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-098FQBQYET");var _hmt=_hmt||[];(function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?3ce504639ccc9604b9ffb2e272f87cd5";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)})();let HOST_LIST=["localhost","javaguide.net"];HOST_LIST.includes(location.hostname)||(console.log("yes include: "+location.hostname),console.log("while to rewrite"),setTimeout(function(){window.location.href="https://javaguide.net"},3e3));var bp=document.createElement("script"),curProtocol=window.location.protocol.split(":")[0];curProtocol==="https"?bp.src="https://zz.bdstatic.com/linksubmit/push.js":bp.src="http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <link rel="canonical" href="https://javaguide.net/百万架构师/并发编程/并发的框架.html">
    <meta name="keywords" content="并发的框架 , JavaGuide , JavaGuide官网, Java面试指南, Java基础, 多线程, JVM, 虚拟机, 数据库, MySQL, Spring, Redis, MyBatis, 系统设计, 分布式, RPC, 高可用, 高并发">
    <meta name="og:url" content="https://JavaGuide.net">
    <meta name="og:type" content="website">
    <meta name="og:image" content="https://javaguide.net/JavaGuide-og.png">
    <meta name="og:title" content="并发的框架 | JavaGuide | Java面试指南 | JavaGuide官网">
    <meta name="og:description" content="并发的框架 | JavaGuide | Java面试指南 | JavaGuide官网 | 「JavaGuide.net」一份涵盖大部分 Java 程序员所需要掌握的核心知识。准备 Java 面试，首选 JavaGuide.net ！">
    <meta name="twitter:site" content="https://javaguide.net">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="nogeek.cn">
    <meta name="twitter:title" content="并发的框架 | JavaGuide | Java面试指南 | JavaGuide官网">
    <meta name="twitter:description" content="并发的框架 | JavaGuide | Java面试指南 | JavaGuide官网 | 「JavaGuide.net」一份涵盖大部分 Java 程序员所需要掌握的核心知识。准备 Java 面试，首选 JavaGuide.net ！">
    <meta name="twitter:image" content="https://javaguide.net/JavaGuide-og.png">
    <meta name="sogou_site_verification" content="fcAkazTXFd">
    <meta name="baidu-site-verification" content="codeva-MXEPYsXKGk">
    <meta name="msvalidate.01" content="9F2D57CFC59E8031212A166878638B15">
  </head>
  <body>
    <div id="app"><div id="container" class="container"><div class="Layout" data-v-4b25b801><!--[--><!--]--><!--[--><span tabindex="-1" data-v-249e09b0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-249e09b0> Skip to content </a><!--]--><!----><header class="VPNav" data-v-4b25b801 data-v-c87fec68><div class="VPNavBar has-sidebar" data-v-c87fec68 data-v-14463604><div class="container" data-v-14463604><div class="title" data-v-14463604><div class="VPNavBarTitle has-sidebar" data-v-14463604 data-v-c97c709f><a class="title" href="/" data-v-c97c709f><!--[--><!--]--><!--[--><img class="VPImage logo" src="/icon-180.png" alt data-v-974317fe><!--]--><!--[--> JavaGuide.net <!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-14463604><div class="curtain" data-v-14463604></div><div class="content-body" data-v-14463604><!--[--><!--]--><div class="VPNavBarSearch search" data-v-14463604><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-14463604 data-v-4586f6f2><span id="main-nav-aria-label" class="visually-hidden" data-v-4586f6f2>Main Navigation</span><!--[--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://nogeek.cn/" target="_blank" rel="noreferrer" tabindex="0" data-v-4586f6f2 data-v-39ed7336><!--[--><span data-v-39ed7336>关于我</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://mcode.net" target="_blank" rel="noreferrer" tabindex="0" data-v-4586f6f2 data-v-39ed7336><!--[--><span data-v-39ed7336>微码产品</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://umlcn.com" target="_blank" rel="noreferrer" tabindex="0" data-v-4586f6f2 data-v-39ed7336><!--[--><span data-v-39ed7336>❤软件方法❤</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/百万架构师/设计模式/设计模式预习资料/Spring5源码分析-第1章.html" tabindex="0" data-v-4586f6f2 data-v-39ed7336><!--[--><span data-v-39ed7336>百万架构师</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-4586f6f2 data-v-3466e098><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3466e098><span class="text" data-v-3466e098><!----><span data-v-3466e098>...</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-3466e098><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-3466e098><div class="VPMenu" data-v-3466e098 data-v-0b41d482><div class="items" data-v-0b41d482><!--[--><!--[--><div class="VPMenuLink" data-v-0b41d482 data-v-3d9048a8><a class="VPLink link" href="/links.html" data-v-3d9048a8><!--[-->友链<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-14463604 data-v-59d15b2f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-59d15b2f data-v-03ad5bfa data-v-fb3ee709><span class="check" data-v-fb3ee709><span class="icon" data-v-fb3ee709><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-03ad5bfa><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-03ad5bfa><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-14463604 data-v-1518e1b3 data-v-58afc869><!--[--><a class="VPSocialLink no-icon" href="https://github.com/nogeek-cn" aria-label="github" target="_blank" rel="noopener" data-v-58afc869 data-v-4db07d50><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://github.com/javaguide-net" aria-label="github" target="_blank" rel="noopener" data-v-58afc869 data-v-4db07d50><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://x.com/noGeek_cn" aria-label="x" target="_blank" rel="noopener" data-v-58afc869 data-v-4db07d50><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>X</title><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></a><a class="VPSocialLink no-icon" href="https://www.youtube.com/@nogeek_cn" aria-label="youtube" target="_blank" rel="noopener" data-v-58afc869 data-v-4db07d50><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>YouTube</title><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a><a class="VPSocialLink no-icon" href="https://space.bilibili.com/392517565" aria-label target="_blank" rel="noopener" data-v-58afc869 data-v-4db07d50><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="20" height="20"  viewBox="0 0 512 512" >
<path fill="currentColor" d="M488.6 104.1c16.7 18.1 24.4 39.7 23.3 65.7v202.4c-.4 26.4-9.2 48.1-26.5 65.1c-17.2 17-39.1 25.9-65.5 26.7H92.02c-26.45-.8-48.21-9.8-65.28-27.2C9.682 419.4.767 396.5 0 368.2V169.8c.767-26 9.682-47.6 26.74-65.7C43.81 87.75 65.57 78.77 92.02 78h29.38L96.05 52.19c-5.75-5.73-8.63-13-8.63-21.79c0-8.8 2.88-16.06 8.63-21.797C101.8 2.868 109.1 0 117.9 0s16.1 2.868 21.9 8.603L213.1 78h88l74.5-69.397C381.7 2.868 389.2 0 398 0c8.8 0 16.1 2.868 21.9 8.603c5.7 5.737 8.6 12.997 8.6 21.797c0 8.79-2.9 16.06-8.6 21.79L394.6 78h29.3c26.4.77 48 9.75 64.7 26.1zm-38.8 69.7c-.4-9.6-3.7-17.4-10.7-23.5c-5.2-6.1-14-9.4-22.7-9.8H96.05c-9.59.4-17.45 3.7-23.58 9.8c-6.14 6.1-9.4 13.9-9.78 23.5v194.4c0 9.2 3.26 17 9.78 23.5s14.38 9.8 23.58 9.8H416.4c9.2 0 17-3.3 23.3-9.8c6.3-6.5 9.7-14.3 10.1-23.5V173.8zm-264.3 42.7c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2c-6.2 6.3-14 9.5-23.6 9.5c-9.6 0-17.5-3.2-23.6-9.5c-6.1-6.3-9.4-14-9.8-23.2v-33.3c.4-9.1 3.8-16.9 10.1-23.2c6.3-6.3 13.2-9.6 23.3-10c9.2.4 17 3.7 23.3 10zm191.5 0c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2c-6.1 6.3-14 9.5-23.6 9.5c-9.6 0-17.4-3.2-23.6-9.5c-7-6.3-9.4-14-9.7-23.2v-33.3c.3-9.1 3.7-16.9 10-23.2c6.3-6.3 14.1-9.6 23.3-10c9.2.4 17 3.7 23.3 10z"></path>
</svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-14463604 data-v-3fcb6752 data-v-3466e098><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-3466e098><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-3466e098><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-3466e098><div class="VPMenu" data-v-3466e098 data-v-0b41d482><!----><!--[--><!--[--><!----><div class="group" data-v-3fcb6752><div class="item appearance" data-v-3fcb6752><p class="label" data-v-3fcb6752>切换主题</p><div class="appearance-action" data-v-3fcb6752><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-3fcb6752 data-v-03ad5bfa data-v-fb3ee709><span class="check" data-v-fb3ee709><span class="icon" data-v-fb3ee709><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-03ad5bfa><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-03ad5bfa><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-3fcb6752><div class="item social-links" data-v-3fcb6752><div class="VPSocialLinks social-links-list" data-v-3fcb6752 data-v-58afc869><!--[--><a class="VPSocialLink no-icon" href="https://github.com/nogeek-cn" aria-label="github" target="_blank" rel="noopener" data-v-58afc869 data-v-4db07d50><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://github.com/javaguide-net" aria-label="github" target="_blank" rel="noopener" data-v-58afc869 data-v-4db07d50><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://x.com/noGeek_cn" aria-label="x" target="_blank" rel="noopener" data-v-58afc869 data-v-4db07d50><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>X</title><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg></a><a class="VPSocialLink no-icon" href="https://www.youtube.com/@nogeek_cn" aria-label="youtube" target="_blank" rel="noopener" data-v-58afc869 data-v-4db07d50><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>YouTube</title><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a><a class="VPSocialLink no-icon" href="https://space.bilibili.com/392517565" aria-label target="_blank" rel="noopener" data-v-58afc869 data-v-4db07d50><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" width="20" height="20"  viewBox="0 0 512 512" >
<path fill="currentColor" d="M488.6 104.1c16.7 18.1 24.4 39.7 23.3 65.7v202.4c-.4 26.4-9.2 48.1-26.5 65.1c-17.2 17-39.1 25.9-65.5 26.7H92.02c-26.45-.8-48.21-9.8-65.28-27.2C9.682 419.4.767 396.5 0 368.2V169.8c.767-26 9.682-47.6 26.74-65.7C43.81 87.75 65.57 78.77 92.02 78h29.38L96.05 52.19c-5.75-5.73-8.63-13-8.63-21.79c0-8.8 2.88-16.06 8.63-21.797C101.8 2.868 109.1 0 117.9 0s16.1 2.868 21.9 8.603L213.1 78h88l74.5-69.397C381.7 2.868 389.2 0 398 0c8.8 0 16.1 2.868 21.9 8.603c5.7 5.737 8.6 12.997 8.6 21.797c0 8.79-2.9 16.06-8.6 21.79L394.6 78h29.3c26.4.77 48 9.75 64.7 26.1zm-38.8 69.7c-.4-9.6-3.7-17.4-10.7-23.5c-5.2-6.1-14-9.4-22.7-9.8H96.05c-9.59.4-17.45 3.7-23.58 9.8c-6.14 6.1-9.4 13.9-9.78 23.5v194.4c0 9.2 3.26 17 9.78 23.5s14.38 9.8 23.58 9.8H416.4c9.2 0 17-3.3 23.3-9.8c6.3-6.5 9.7-14.3 10.1-23.5V173.8zm-264.3 42.7c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2c-6.2 6.3-14 9.5-23.6 9.5c-9.6 0-17.5-3.2-23.6-9.5c-6.1-6.3-9.4-14-9.8-23.2v-33.3c.4-9.1 3.8-16.9 10.1-23.2c6.3-6.3 13.2-9.6 23.3-10c9.2.4 17 3.7 23.3 10zm191.5 0c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2c-6.1 6.3-14 9.5-23.6 9.5c-9.6 0-17.4-3.2-23.6-9.5c-7-6.3-9.4-14-9.7-23.2v-33.3c.3-9.1 3.7-16.9 10-23.2c6.3-6.3 14.1-9.6 23.3-10c9.2.4 17 3.7 23.3 10z"></path>
</svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-14463604 data-v-40980a1a><span class="container" data-v-40980a1a><span class="top" data-v-40980a1a></span><span class="middle" data-v-40980a1a></span><span class="bottom" data-v-40980a1a></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-4b25b801 data-v-57b36054><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-57b36054><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-57b36054><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-57b36054>菜单</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-57b36054 data-v-cc71a411><button data-v-cc71a411>回到顶部</button><!----></div></div><aside class="VPSidebar" data-v-4b25b801 data-v-a6cdb1c7><div class="curtain" data-v-a6cdb1c7></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-a6cdb1c7><span class="visually-hidden" id="sidebar-aria-label" data-v-a6cdb1c7> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-a6cdb1c7><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a6cdb1c7 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h2 class="text" data-v-c49d22f2>设计模式</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><section class="VPSidebarItem level-1 collapsible" data-v-c49d22f2 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h3 class="text" data-v-c49d22f2>设计模式预习资料</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><div class="VPSidebarItem level-2 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E9%A2%84%E4%B9%A0%E8%B5%84%E6%96%99/Spring5%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E7%AC%AC1%E7%AB%A0.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Spring5源码分析-第1章</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E9%A2%84%E4%B9%A0%E8%B5%84%E6%96%99/Spring5%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E7%AC%AC2%E7%AB%A0.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Spring5源码分析-第2章</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/Spring%E7%A7%8D%E5%B8%B8%E7%94%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%8F%8A%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Spring种常用的设计模式及工厂模式详解</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>单例模式-原型模式</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>深度分析代理模式</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E5%8F%8A%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>策略模式及模板模式</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%BC%8F%E5%8F%8A%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>委派模式及适配器模式</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F%E5%8F%8A%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>装饰器模式及观察者模式</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%90%84%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93%E5%8F%8A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>各种设计模式总结及应用场景</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%B9%E6%98%93%E6%B7%B7%E6%B7%86%E7%9A%84%E5%87%A0%E4%B8%AA%E5%AF%B9%E6%AF%94.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>设计模式容易混淆的几个对比</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a6cdb1c7><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a6cdb1c7 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h2 class="text" data-v-c49d22f2>Mybatis 源码分析</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Mybatis%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Mybatis%E4%BB%8B%E7%BB%8D%E4%BD%BF%E7%94%A8%E5%92%8C%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Mybatis介绍使用和深度分析</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a6cdb1c7><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a6cdb1c7 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h2 class="text" data-v-c49d22f2>Spring 源码分析</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><section class="VPSidebarItem level-1 collapsible" data-v-c49d22f2 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h3 class="text" data-v-c49d22f2>预习资料</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><div class="VPSidebarItem level-2 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E9%A2%84%E4%B9%A0%E8%B5%84%E6%96%99/Spring5%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-%E9%A2%84%E4%B9%A0%E8%B5%84%E6%96%99.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Spring5源码分析-预习资料</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Spring%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E5%89%8D%E7%AF%87.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Spring源码分析前篇</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Spring%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%E5%8F%8AIOC%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Spring系统概述及IOC实现原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Spring%E6%A0%B8%E5%BF%83IOC%E5%AE%B9%E5%99%A8%E5%8F%8A%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Spring核心IOC容器及依赖注入原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90IOC%E9%82%A3%E4%BA%9B%E9%B2%9C%E4%B8%BA%E4%BA%BA%E7%9F%A5%E7%9A%84%E7%BB%86%E8%8A%82.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>深入分析IOC那些鲜为人知的细节</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E6%89%8B%E5%86%99SpringIOC%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>手写SpringIOC核心代码</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/SpringMVC%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E5%8F%8A%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>SpringMVC核心原理及源码分析</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E6%89%8B%E5%86%99SpringMVC2.0%E7%89%88%E6%9C%AC.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>手写SpringMVC2.0版本</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E6%89%8B%E5%86%99SpringAOP%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>手写SpringAOP核心原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Spring%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Spring声明式事务操作实现原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1%E6%93%8D%E4%BD%9C%E5%8E%9F%E7%90%86%E5%8F%8ASpringAOP%E9%85%8D%E7%BD%AE.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>数据库事务操作原理及SpringAOP配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E6%89%8B%E5%86%99ORM%E6%A1%86%E6%9E%B6%E9%A1%B6%E5%B1%82%E8%AE%BE%E8%AE%A1.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>手写ORM框架顶层设计</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E6%89%8B%E5%86%99%E5%AE%9A%E5%88%B6%E8%87%AA%E5%B7%B1%E7%9A%84ORM%E6%A1%86%E6%9E%B6.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>手写定制自己的ORM框架</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Spring5%E6%96%B0%E7%89%B9%E6%80%A7%E5%8F%8A%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Spring5新特性及应用举例</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Spring%20%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Spring%E7%BB%8F%E5%85%B8%E9%9D%A2%E8%AF%95%E7%AD%94%E7%96%91.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Spring经典面试答疑</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a6cdb1c7><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a6cdb1c7 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h2 class="text" data-v-c49d22f2>漫谈分布式架构</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E6%BC%AB%E8%B0%88%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E8%BF%9B%E8%BF%87%E7%A8%8B.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>分布式架构的演进过程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E6%BC%AB%E8%B0%88%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>分布式架构设计</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a6cdb1c7><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a6cdb1c7 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h2 class="text" data-v-c49d22f2>分布式架构的基础</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E7%9A%84%E5%9F%BA%E7%A1%80/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9F%BA%E7%9F%B3TCP-IP%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>分布式系统的基石TCP-IP通讯协议</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E7%9A%84%E5%9F%BA%E7%A1%80/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9F%BA%E7%9F%B3HTTP%E5%8D%8F%E8%AE%AE%E4%B8%8EHTTPS%E5%8D%8F%E8%AE%AE.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>分布式系统的基石HTTP协议与HTTPS协议</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84%E7%9A%84%E5%9F%BA%E7%A1%80/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%9F%BA%E7%9F%B3-%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>分布式系统的基石-序列化和反序列化</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a6cdb1c7><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a6cdb1c7 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h2 class="text" data-v-c49d22f2>RMI</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/RMI/%E5%88%86%E5%B8%83%E5%BC%8F%E9%80%9A%E8%AE%AF%E6%A1%86%E6%9E%B6RMI%E7%9A%84%E5%8E%9F%E7%90%86.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>分布式通讯框架RMI的原理</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a6cdb1c7><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a6cdb1c7 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h2 class="text" data-v-c49d22f2>协调服务-zookeeper</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%8D%8F%E8%B0%83%E6%9C%8D%E5%8A%A1-zookeeper/%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86zookeeper.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>初步认识zookeeper</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%8D%8F%E8%B0%83%E6%9C%8D%E5%8A%A1-zookeeper/%E4%BA%86%E8%A7%A3zookeeper%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>了解zookeeper的核心原理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%8D%8F%E8%B0%83%E6%9C%8D%E5%8A%A1-zookeeper/zookeeper%E5%AE%9E%E8%B7%B5%E4%B9%8B%E9%85%8D%E5%90%88%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%AE%8C%E6%88%90RPC%E6%89%8B%E5%86%99.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>zookeeper实践之配合注册中心完成RPC手写</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%8D%8F%E8%B0%83%E6%9C%8D%E5%8A%A1-zookeeper/zookeeper%E7%9A%84%E5%AE%9E%E8%B7%B5%E4%B8%8E%E5%8E%9F%E7%90%86.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>zookeeper的实践与原理</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a6cdb1c7><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a6cdb1c7 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h2 class="text" data-v-c49d22f2>kafka</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/kafka/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%80%9A%E4%BF%A1Kafka(%E4%B8%80).html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>分布式消息通信Kafka(一)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/kafka/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%80%9A%E4%BF%A1Kafka(%E4%BA%8C).html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>分布式消息通信Kafka(二)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/kafka/%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E9%80%9A%E4%BF%A1Kafka(%E4%B8%89).html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>分布式消息通信Kafka(三)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/kafka/KafkaManage.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>KafkaManage</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a6cdb1c7><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a6cdb1c7 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h2 class="text" data-v-c49d22f2>RabbitMq</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/RabbitMq/%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%AD%A5%E9%AA%A4.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>高可用集群搭建步骤</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/RabbitMq/Windows%E5%AE%89%E8%A3%85RabbitMq.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Windows安装RabbitMq</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/RabbitMq/Linux%E5%AE%89%E8%A3%85RabbitMq.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Linux安装RabbitMq</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/RabbitMq/RabbitMq-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%9E%8B%E4%B8%8EJAVA%E7%BC%96%E7%A8%8B.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>RabbitMq-工作模型与JAVA编程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/RabbitMq/%E5%8F%AF%E9%9D%A0%E6%80%A7%E6%8A%95%E9%80%92%E5%92%8C%E5%AE%9E%E8%B7%B5%E7%BB%8F%E9%AA%8C.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>可靠性投递和实践经验</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a6cdb1c7><section class="VPSidebarItem level-0 collapsible collapsed" data-v-a6cdb1c7 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h2 class="text" data-v-c49d22f2>Nginx</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Nginx/Nginx%20%E7%9A%84%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Nginx 的初步认识</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Nginx/Nginx%20%E5%BA%94%E7%94%A8%E5%AE%9E%E6%88%98.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Nginx 应用实战</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/Nginx/Nginx%20%E7%9A%84%E6%89%A9%E5%B1%95-OpenRestry.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>Nginx 的扩展-OpenRestry</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-a6cdb1c7><section class="VPSidebarItem level-0 collapsible has-active" data-v-a6cdb1c7 data-v-c49d22f2><div class="item" role="button" tabindex="0" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><h2 class="text" data-v-c49d22f2>并发编程</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c49d22f2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c49d22f2><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c49d22f2><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E5%9F%BA%E7%A1%80.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>并发编程的基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E5%8E%9F%E7%90%86(%E4%B8%80).html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>并发编程的原理(一)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E5%8E%9F%E7%90%86(%E4%BA%8C).html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>并发编程的原理(二)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E5%8E%9F%E7%90%86(%E4%B8%89).html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>并发编程的原理(三)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c49d22f2 data-v-c49d22f2><div class="item" data-v-c49d22f2><div class="indicator" data-v-c49d22f2></div><a class="VPLink link link" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%9A%84%E6%A1%86%E6%9E%B6.html" data-v-c49d22f2><!--[--><p class="text" data-v-c49d22f2>并发的框架</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-4b25b801 data-v-56177731><div class="VPDoc has-sidebar has-aside" data-v-56177731 data-v-407ae146><!--[--><!--]--><div class="container" data-v-407ae146><div class="aside" data-v-407ae146><div class="aside-curtain" data-v-407ae146></div><div class="aside-container" data-v-407ae146><div class="aside-content" data-v-407ae146><div class="VPDocAside" data-v-407ae146 data-v-b66a4b0b><!--[--><!--]--><!--[--><!--[--><!--[--><!--[--><!--[--><div style="background-color:var(--vp-c-bg-soft);"><div style="margin:20px 20px 20px 20px;"><img src="/qrimg/wxpublic/out/03.png" alt="微信公众号"></div></div><br><!--]--><!--]--><!--]--><!--]--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-b66a4b0b data-v-8dbd939c><div class="content" data-v-8dbd939c><div class="outline-marker" data-v-8dbd939c></div><div class="outline-title" role="heading" aria-level="2" data-v-8dbd939c>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-8dbd939c><span class="visually-hidden" id="doc-outline-aria-label" data-v-8dbd939c> Table of Contents for current page </span><ul class="root" data-v-8dbd939c data-v-4301588a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-b66a4b0b></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-407ae146><div class="content-container" data-v-407ae146><!--[--><!--[--><!--[--><blockquote><p><a href="https://javaguide.net/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%9A%84%E6%A1%86%E6%9E%B6.html" target="_blank">本文链接地址</a></p><hr><br></blockquote><!--]--><!--]--><!--]--><!----><main class="main" data-v-407ae146><div style="position:relative;" class="vp-doc _%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88_%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B_%E5%B9%B6%E5%8F%91%E7%9A%84%E6%A1%86%E6%9E%B6 external-link-icon-enabled" data-v-407ae146><div><p><img src="/assets/JavaGuide_并发编程_并发框架_多线程目录.6b0863b7.png" alt="JavaGuide_并发编程_并发框架_多线程目录.png"></p><h3 id="目标" tabindex="-1">目标 <a class="header-anchor" href="#目标" aria-label="Permalink to &quot;目标&quot;">​</a></h3><ul><li><code>CountDownLatch</code> 、 <code>Semaphore</code><ul><li><code>countdown</code> / <code>await</code></li></ul></li><li>原子操作 <code>Atomic</code></li><li>线程池原理分析</li></ul><h1 id="限制" tabindex="-1">限制 <a class="header-anchor" href="#限制" aria-label="Permalink to &quot;限制&quot;">​</a></h1><p>​ <code>JUC</code> 中提供了几个比较常用的并发工具类，比如 <code>CountDownLatch</code> 、<code>CyclicBarrier</code> 、 <code>Semaphore</code> 。 其实在以前我们课堂的演示代码中，或多或少都有用到过这样一些 <strong>api</strong> ，接下来我们会带大家去深入研究一些常用的 <strong>api</strong> 。</p><h2 id="countdownlatch" tabindex="-1"><code>CountDownLatch</code> <a class="header-anchor" href="#countdownlatch" aria-label="Permalink to &quot;`CountDownLatch`&quot;">​</a></h2><p>​ <code>countdownlatch</code> 是一个同步工具类，它允许一个或多个线程一直等待，直到其他线程的操作执行完毕再执行。从命名可以解读到 <code>#countdown</code> 是倒数的意思，类似于我们倒计时的概念。</p><p>​ <code>countdownlatch</code> 提供了两个方法，一个是 <code>#countDown</code> ，一个是 <code>#await</code> ， <code>countdownlatch</code> 初始化的时候需要传入一个整数，在这个整数倒数到0之前，调用了 await 方法的程序都必须要等待，然后通过 <code>#countDown</code> 来倒数。</p><h3 id="使用案例" tabindex="-1">使用案例 <a class="header-anchor" href="#使用案例" aria-label="Permalink to &quot;使用案例&quot;">​</a></h3><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] args) throws InterruptedException {</span></span>
<span class="line"><span style="color:#E1E4E8;">    CountDownLatch countDownLatch</span><span style="color:#F97583;">=new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CountDownLatch</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Thread</span><span style="color:#E1E4E8;">(()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        countDownLatch.</span><span style="color:#B392F0;">countDown</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span><span style="color:#9ECBFF;">&quot;t1&quot;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Thread</span><span style="color:#E1E4E8;">(()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        countDownLatch.</span><span style="color:#B392F0;">countDown</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span><span style="color:#9ECBFF;">&quot;t2&quot;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Thread</span><span style="color:#E1E4E8;">(()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        countDownLatch.</span><span style="color:#B392F0;">countDown</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span><span style="color:#9ECBFF;">&quot;t3&quot;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    countDownLatch.</span><span style="color:#B392F0;">await</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;所有线程执行完毕&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] args) throws InterruptedException {</span></span>
<span class="line"><span style="color:#24292E;">    CountDownLatch countDownLatch</span><span style="color:#D73A49;">=new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CountDownLatch</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Thread</span><span style="color:#24292E;">(()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        countDownLatch.</span><span style="color:#6F42C1;">countDown</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    },</span><span style="color:#032F62;">&quot;t1&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Thread</span><span style="color:#24292E;">(()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        countDownLatch.</span><span style="color:#6F42C1;">countDown</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    },</span><span style="color:#032F62;">&quot;t2&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Thread</span><span style="color:#24292E;">(()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        countDownLatch.</span><span style="color:#6F42C1;">countDown</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    },</span><span style="color:#032F62;">&quot;t3&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    countDownLatch.</span><span style="color:#6F42C1;">await</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;所有线程执行完毕&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>​ 从代码的实现来看，有点类似 <code>#join</code> 的功能，但是比 <code>#join</code> 更加灵活。 <code>CountDownLatch</code> 构造函数会接收一个 <code>int</code> 类型的参数作为计数器的初始值，当调用 <code>CountDownLatch</code> 的 <code>#countDown</code> 方法时，这个计数器就会减一。 ​ 通过 <code>#await</code> 方法去阻塞主流程。</p><p><img src="/assets/JavaGuide_并发编程_并发框架_countDown_await_时序图.366eed4f.png" alt="JavaGuide_并发编程_并发框架_countDown_await_时序图.png"></p><h3 id="使用场景" tabindex="-1">使用场景 <a class="header-anchor" href="#使用场景" aria-label="Permalink to &quot;使用场景&quot;">​</a></h3><ol><li><p>通过 countdownlatch 实现最大的并行请求，也就是可以让 N 个线程同时执行，这个我也是在课堂上写得比较多的 。</p></li><li><p>比如应用程序启动之前，需要确保相应的服务已经启动，比如我们之前在讲 zookeeper 的时候，通过原生 api 连接的地方有用到 countDownLatch 。</p></li></ol><h3 id="源码分析" tabindex="-1">源码分析 <a class="header-anchor" href="#源码分析" aria-label="Permalink to &quot;源码分析&quot;">​</a></h3><p>​ CountDownLatch 类存在一个内部类 Sync ，上节课我们讲过，它是一个同步工具，一定继承了 AbstractQueuedSynchronizer 。很显然， CountDownLatch 实际上让线程阻塞了，既然涉及到阻塞，就一定涉及 AQS 队列。</p><h4 id="await" tabindex="-1">await <a class="header-anchor" href="#await" aria-label="Permalink to &quot;await&quot;">​</a></h4><p>​ <code>#await</code> 函数会使得当前线程在 <code>countdownlatch</code> 倒计时到0之前一直等待，除非线程别中断；从源码中可以得知 <code>await</code> 方法会转发到 <code>Sync</code> 的<code>acquireSharedInterruptibly</code>方法</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">await</span><span style="color:#E1E4E8;">() throws InterruptedException { 		</span></span>
<span class="line"><span style="color:#E1E4E8;">    sync.</span><span style="color:#B392F0;">acquireSharedInterruptibly</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">await</span><span style="color:#24292E;">() throws InterruptedException { 		</span></span>
<span class="line"><span style="color:#24292E;">    sync.</span><span style="color:#6F42C1;">acquireSharedInterruptibly</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="acquiresharedinterruptibly" tabindex="-1">acquireSharedInterruptibly <a class="header-anchor" href="#acquiresharedinterruptibly" aria-label="Permalink to &quot;acquireSharedInterruptibly&quot;">​</a></h4><p>​ 这块代码主要是判断当前线程是否获取到了共享锁； 上一节课提到过，AQS有两种锁类型，一种是共享锁，一种是独占锁，在这里用的是共享锁； 为什么要用共享锁，因为 CountDownLatch 可以多个线程同时通过。</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">acquireSharedInterruptibly</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> arg)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">throws InterruptedException {</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (Thread.</span><span style="color:#B392F0;">interrupted</span><span style="color:#E1E4E8;">()) </span><span style="color:#6A737D;">//判断线程是否中断</span></span>
<span class="line"><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">InterruptedException</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">tryAcquireShared</span><span style="color:#E1E4E8;">(arg) </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">//如果等于0则返回1，否则返回-1，返回-1表示需要阻塞</span></span>
<span class="line"><span style="color:#B392F0;">doAcquireSharedInterruptibly</span><span style="color:#E1E4E8;">(arg);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">//在这里，state的意义是count，如果计数器为0，表示不需要阻塞，否则，只有在满足条件的情况下才会被唤醒</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">acquireSharedInterruptibly</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> arg)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">throws InterruptedException {</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (Thread.</span><span style="color:#6F42C1;">interrupted</span><span style="color:#24292E;">()) </span><span style="color:#6A737D;">//判断线程是否中断</span></span>
<span class="line"><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InterruptedException</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">tryAcquireShared</span><span style="color:#24292E;">(arg) </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) </span><span style="color:#6A737D;">//如果等于0则返回1，否则返回-1，返回-1表示需要阻塞</span></span>
<span class="line"><span style="color:#6F42C1;">doAcquireSharedInterruptibly</span><span style="color:#24292E;">(arg);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">//在这里，state的意义是count，如果计数器为0，表示不需要阻塞，否则，只有在满足条件的情况下才会被唤醒</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="doacquiresharedinterruptibly" tabindex="-1">doAcquireSharedInterruptibly <a class="header-anchor" href="#doacquiresharedinterruptibly" aria-label="Permalink to &quot;doAcquireSharedInterruptibly&quot;">​</a></h4><p>获取共享锁</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">doAcquireSharedInterruptibly</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> arg)</span></span>
<span class="line"><span style="color:#E1E4E8;">    throws InterruptedException {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> Node node </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">addWaiter</span><span style="color:#E1E4E8;">(Node.SHARED); </span><span style="color:#6A737D;">//创建一个共享模式的节点添加到队列中</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> failed </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (;;) { </span><span style="color:#6A737D;">//自旋等待共享锁释放，也就是等待计数器等于0。</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> Node p </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> node.</span><span style="color:#B392F0;">predecessor</span><span style="color:#E1E4E8;">(); </span><span style="color:#6A737D;">//获得当前节点的前一个节点</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (p </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> head) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> r </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">tryAcquireShared</span><span style="color:#E1E4E8;">(arg);</span><span style="color:#6A737D;">//就判断尝试获取锁</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (r </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) {</span><span style="color:#6A737D;">//r&gt;=0表示计数器已经归零了，则释放当前的共享锁</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">setHeadAndPropagate</span><span style="color:#E1E4E8;">(node, r);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    p.next </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// help GC</span></span>
<span class="line"><span style="color:#E1E4E8;">                    failed </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">//当前节点不是头节点，则尝试让当前线程阻塞，第一个方法是判断是否需要阻塞，第二个方法是阻塞</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">shouldParkAfterFailedAcquire</span><span style="color:#E1E4E8;">(p, node) </span><span style="color:#F97583;">&amp;&amp;</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">parkAndCheckInterrupt</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">InterruptedException</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">finally</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (failed)</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">cancelAcquire</span><span style="color:#E1E4E8;">(node);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">doAcquireSharedInterruptibly</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> arg)</span></span>
<span class="line"><span style="color:#24292E;">    throws InterruptedException {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> Node node </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">addWaiter</span><span style="color:#24292E;">(Node.SHARED); </span><span style="color:#6A737D;">//创建一个共享模式的节点添加到队列中</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> failed </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (;;) { </span><span style="color:#6A737D;">//自旋等待共享锁释放，也就是等待计数器等于0。</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> Node p </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> node.</span><span style="color:#6F42C1;">predecessor</span><span style="color:#24292E;">(); </span><span style="color:#6A737D;">//获得当前节点的前一个节点</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (p </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> head) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> r </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">tryAcquireShared</span><span style="color:#24292E;">(arg);</span><span style="color:#6A737D;">//就判断尝试获取锁</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (r </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) {</span><span style="color:#6A737D;">//r&gt;=0表示计数器已经归零了，则释放当前的共享锁</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">setHeadAndPropagate</span><span style="color:#24292E;">(node, r);</span></span>
<span class="line"><span style="color:#24292E;">                    p.next </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">// help GC</span></span>
<span class="line"><span style="color:#24292E;">                    failed </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">//当前节点不是头节点，则尝试让当前线程阻塞，第一个方法是判断是否需要阻塞，第二个方法是阻塞</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">shouldParkAfterFailedAcquire</span><span style="color:#24292E;">(p, node) </span><span style="color:#D73A49;">&amp;&amp;</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">parkAndCheckInterrupt</span><span style="color:#24292E;">())</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InterruptedException</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    } </span><span style="color:#D73A49;">finally</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (failed)</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">cancelAcquire</span><span style="color:#24292E;">(node);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="setheadandpropagate" tabindex="-1">setHeadAndPropagate <a class="header-anchor" href="#setheadandpropagate" aria-label="Permalink to &quot;setHeadAndPropagate&quot;">​</a></h4><p><img src="/assets/JavaGuide_并发编程_并发框架_countDown_AQS_状态.2037bc3f.png" alt="JavaGuide_并发编程_并发框架_countDown_AQS_状态.png"></p><p><strong>PROPAGATE</strong>：值为 - 3 ，表示 releaseShared 需要被传递给后续节点</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setHeadAndPropagate</span><span style="color:#E1E4E8;">(Node node, </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> propagate) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    Node h </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> head; </span><span style="color:#6A737D;">// 记录头节点</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">setHead</span><span style="color:#E1E4E8;">(node); </span><span style="color:#6A737D;">//设置当前节点为头节点</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//前面传过来的propagate是1，所以会进入下面的代码</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (propagate </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> h </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> h.waitStatus </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span></span>
<span class="line"><span style="color:#E1E4E8;">        (h </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> head) </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> h.waitStatus </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        Node s </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> node.next; </span><span style="color:#6A737D;">//获得当前节点的下一个节点，如果下一个节点是空表示当前节点为最后一个节点，或者下一个节点是share节点</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (s </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> s.</span><span style="color:#B392F0;">isShared</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">doReleaseShared</span><span style="color:#E1E4E8;">(); </span><span style="color:#6A737D;">//唤醒下一个共享节点</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setHeadAndPropagate</span><span style="color:#24292E;">(Node node, </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> propagate) {</span></span>
<span class="line"><span style="color:#24292E;">    Node h </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> head; </span><span style="color:#6A737D;">// 记录头节点</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">setHead</span><span style="color:#24292E;">(node); </span><span style="color:#6A737D;">//设置当前节点为头节点</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//前面传过来的propagate是1，所以会进入下面的代码</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (propagate </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> h </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> h.waitStatus </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span></span>
<span class="line"><span style="color:#24292E;">        (h </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> head) </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> h.waitStatus </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        Node s </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> node.next; </span><span style="color:#6A737D;">//获得当前节点的下一个节点，如果下一个节点是空表示当前节点为最后一个节点，或者下一个节点是share节点</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (s </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> s.</span><span style="color:#6F42C1;">isShared</span><span style="color:#24292E;">())</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">doReleaseShared</span><span style="color:#24292E;">(); </span><span style="color:#6A737D;">//唤醒下一个共享节点</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="doreleaseshared" tabindex="-1">doReleaseShared <a class="header-anchor" href="#doreleaseshared" aria-label="Permalink to &quot;doReleaseShared&quot;">​</a></h4><p>释放共享锁，通知后面的节点</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">doReleaseShared</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (;;) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        Node h </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> head; </span><span style="color:#6A737D;">//获得头节点</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (h </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> h </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> tail) { </span><span style="color:#6A737D;">//如果头节点不为空且不等于tail节点</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> ws </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> h.waitStatus;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (ws </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> Node.SIGNAL) { </span><span style="color:#6A737D;">//头节点状态为SIGNAL，</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#B392F0;">compareAndSetWaitStatus</span><span style="color:#E1E4E8;">(h, Node.SIGNAL, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)) </span><span style="color:#6A737D;">//修改当前头节点的状态为0, 避免下次再进入到这个里面</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">continue</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// loop to recheck cases</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">unparkSuccessor</span><span style="color:#E1E4E8;">(h); </span><span style="color:#6A737D;">//释放后续节点</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (ws </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">!</span><span style="color:#B392F0;">compareAndSetWaitStatus</span><span style="color:#E1E4E8;">(h, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, Node.PROPAGATE))</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">continue</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// loop on failed CAS</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (h </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> head) </span><span style="color:#6A737D;">// loop if head changed</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">doReleaseShared</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (;;) {</span></span>
<span class="line"><span style="color:#24292E;">        Node h </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> head; </span><span style="color:#6A737D;">//获得头节点</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (h </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> h </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> tail) { </span><span style="color:#6A737D;">//如果头节点不为空且不等于tail节点</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> ws </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> h.waitStatus;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (ws </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> Node.SIGNAL) { </span><span style="color:#6A737D;">//头节点状态为SIGNAL，</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#6F42C1;">compareAndSetWaitStatus</span><span style="color:#24292E;">(h, Node.SIGNAL, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)) </span><span style="color:#6A737D;">//修改当前头节点的状态为0, 避免下次再进入到这个里面</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">continue</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">// loop to recheck cases</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">unparkSuccessor</span><span style="color:#24292E;">(h); </span><span style="color:#6A737D;">//释放后续节点</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (ws </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">!</span><span style="color:#6F42C1;">compareAndSetWaitStatus</span><span style="color:#24292E;">(h, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, Node.PROPAGATE))</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">continue</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">// loop on failed CAS</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (h </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> head) </span><span style="color:#6A737D;">// loop if head changed</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">break</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="countdown" tabindex="-1">countdown <a class="header-anchor" href="#countdown" aria-label="Permalink to &quot;countdown&quot;">​</a></h4><p>​ 以共享模式释放锁，并且会调用tryReleaseShared函数，根据判断条件也可能会调用doReleaseShared函数</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">releaseShared</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> arg) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">tryReleaseShared</span><span style="color:#E1E4E8;">(arg)) { </span><span style="color:#6A737D;">//如果为true，表示计数器已归0了</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">doReleaseShared</span><span style="color:#E1E4E8;">(); </span><span style="color:#6A737D;">//唤醒处于阻塞的线程</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">releaseShared</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> arg) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">tryReleaseShared</span><span style="color:#24292E;">(arg)) { </span><span style="color:#6A737D;">//如果为true，表示计数器已归0了</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">doReleaseShared</span><span style="color:#24292E;">(); </span><span style="color:#6A737D;">//唤醒处于阻塞的线程</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="tryreleaseshared" tabindex="-1">tryReleaseShared <a class="header-anchor" href="#tryreleaseshared" aria-label="Permalink to &quot;tryReleaseShared&quot;">​</a></h4><p>​ 这里主要是对state做原子递减，其实就是我们构造的CountDownLatch的计数器，如果等于0返回true，否则返回false</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">tryReleaseShared</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> releases) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Decrement count; signal when transition to zero</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (;;) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> c </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getState</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (c </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> nextc </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> c</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">compareAndSetState</span><span style="color:#E1E4E8;">(c, nextc))</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> nextc </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">tryReleaseShared</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> releases) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Decrement count; signal when transition to zero</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (;;) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> c </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getState</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (c </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> nextc </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> c</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">compareAndSetState</span><span style="color:#24292E;">(c, nextc))</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> nextc </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="semaphore" tabindex="-1">Semaphore <a class="header-anchor" href="#semaphore" aria-label="Permalink to &quot;Semaphore&quot;">​</a></h2><p>​ <code>semaphore</code> 也就是我们常说的信号灯，<code>semaphore</code> 可以控制同时访问的线程个数，通过 acquire 获取一个许可，如果没有就等待，通过 release 释放一个许可。有点类似限流的作用。叫信号灯的原因也和他的用处有关，比如某商场就 5 个停车位，每个停车位只能停一辆车，如果这个时候来了 10 辆车，必须要等前面有空的车位才能进入。</p><h3 id="使用案例-1" tabindex="-1">使用案例 <a class="header-anchor" href="#使用案例-1" aria-label="Permalink to &quot;使用案例&quot;">​</a></h3><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Test</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">args</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        Semaphore semaphore</span><span style="color:#F97583;">=new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Semaphore</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> i</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;i</span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">;i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Car</span><span style="color:#E1E4E8;">(i,semaphore).</span><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Car</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Thread</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> num;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> Semaphore semaphore;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Car</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">num</span><span style="color:#E1E4E8;">, Semaphore </span><span style="color:#FFAB70;">semaphore</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.num </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> num;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.semaphore </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> semaphore;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                semaphore.</span><span style="color:#B392F0;">acquire</span><span style="color:#E1E4E8;">();</span><span style="color:#6A737D;">//获取一个许可</span></span>
<span class="line"><span style="color:#E1E4E8;">                System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;第&quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">num</span><span style="color:#F97583;">+</span><span style="color:#9ECBFF;">&quot;占用一个停车位&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">                TimeUnit.SECONDS.</span><span style="color:#B392F0;">sleep</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">                System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;第&quot;</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">num</span><span style="color:#F97583;">+</span><span style="color:#9ECBFF;">&quot;俩车走喽&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">                semaphore.</span><span style="color:#B392F0;">release</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (InterruptedException </span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                e.</span><span style="color:#B392F0;">printStackTrace</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Test</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        Semaphore semaphore</span><span style="color:#D73A49;">=new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Semaphore</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">5</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;i</span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">;i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Car</span><span style="color:#24292E;">(i,semaphore).</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Car</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Thread</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> num;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> Semaphore semaphore;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Car</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#E36209;">num</span><span style="color:#24292E;">, Semaphore </span><span style="color:#E36209;">semaphore</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.num </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> num;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.semaphore </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> semaphore;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                semaphore.</span><span style="color:#6F42C1;">acquire</span><span style="color:#24292E;">();</span><span style="color:#6A737D;">//获取一个许可</span></span>
<span class="line"><span style="color:#24292E;">                System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;第&quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">num</span><span style="color:#D73A49;">+</span><span style="color:#032F62;">&quot;占用一个停车位&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                TimeUnit.SECONDS.</span><span style="color:#6F42C1;">sleep</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;第&quot;</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">num</span><span style="color:#D73A49;">+</span><span style="color:#032F62;">&quot;俩车走喽&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">                semaphore.</span><span style="color:#6F42C1;">release</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (InterruptedException </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                e.</span><span style="color:#6F42C1;">printStackTrace</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="使用场景-1" tabindex="-1">使用场景 <a class="header-anchor" href="#使用场景-1" aria-label="Permalink to &quot;使用场景&quot;">​</a></h3><p>​ 可以实现对某些接口访问的限流</p><h3 id="源码分析-1" tabindex="-1">源码分析 <a class="header-anchor" href="#源码分析-1" aria-label="Permalink to &quot;源码分析&quot;">​</a></h3><p>​ <code>semaphore</code> 也是基于 AQS 来实现的，内部使用state表示许可数量；它的实现方式和 CountDownLatch 的差异点在于 acquireSharedInterruptibly 中的 tryAcquireShared 方法的实现，这个方法是在 Semaphore 方法中重写的</p><h4 id="acquiresharedinterruptibly-1" tabindex="-1">acquireSharedInterruptibly <a class="header-anchor" href="#acquiresharedinterruptibly-1" aria-label="Permalink to &quot;acquireSharedInterruptibly&quot;">​</a></h4><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">acquireSharedInterruptibly</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> arg)</span></span>
<span class="line"><span style="color:#E1E4E8;">    throws InterruptedException {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (Thread.</span><span style="color:#B392F0;">interrupted</span><span style="color:#E1E4E8;">())</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">InterruptedException</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">tryAcquireShared</span><span style="color:#E1E4E8;">(arg) </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">doAcquireSharedInterruptibly</span><span style="color:#E1E4E8;">(arg);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">acquireSharedInterruptibly</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> arg)</span></span>
<span class="line"><span style="color:#24292E;">    throws InterruptedException {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (Thread.</span><span style="color:#6F42C1;">interrupted</span><span style="color:#24292E;">())</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">InterruptedException</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">tryAcquireShared</span><span style="color:#24292E;">(arg) </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">doAcquireSharedInterruptibly</span><span style="color:#24292E;">(arg);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="tryacquireshared" tabindex="-1">tryAcquireShared <a class="header-anchor" href="#tryacquireshared" aria-label="Permalink to &quot;tryAcquireShared&quot;">​</a></h4><p>​ 在 <code>semaphore</code> 中存在公平和非公平的方式，和重入锁是一样的，如果通过 <code>FairSync</code> 表示公平的信号量、 <code>NonFairSync</code> 表示非公平的信号量；公平和非公平取决于是否按照 <strong>FIFO</strong> 队列中的顺序去分配 <code>Semaphore</code> 所维护的许可，我们来看非公平锁的实现</p><h4 id="nonfairtryacquireshared" tabindex="-1">nonfairTryAcquireShared <a class="header-anchor" href="#nonfairtryacquireshared" aria-label="Permalink to &quot;nonfairTryAcquireShared&quot;">​</a></h4><p>​ 自旋去获得一个许可，如果许可获取失败，也就是 <code>remaining &lt; 0</code> 的情况下，让当前线程阻塞。</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">nonfairTryAcquireShared</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> acquires) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (;;) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> available </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getState</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> remaining </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> available </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> acquires;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (remaining </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">compareAndSetState</span><span style="color:#E1E4E8;">(available, remaining))</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> remaining;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">nonfairTryAcquireShared</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> acquires) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (;;) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> available </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getState</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> remaining </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> available </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> acquires;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (remaining </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">compareAndSetState</span><span style="color:#24292E;">(available, remaining))</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> remaining;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="releaseshared" tabindex="-1">releaseShared <a class="header-anchor" href="#releaseshared" aria-label="Permalink to &quot;releaseShared&quot;">​</a></h4><p>​ releaseShared 方法的逻辑也很简单，就是通过线程安全的方式去增加一个许可，如果增加成功，则触发释放一个共享锁，也就是让之前处于阻塞的线程重新运行</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">releaseShared</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> arg) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">tryReleaseShared</span><span style="color:#E1E4E8;">(arg)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">doReleaseShared</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">releaseShared</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> arg) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">tryReleaseShared</span><span style="color:#24292E;">(arg)) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">doReleaseShared</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​ 增加令牌数</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">protected</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">tryReleaseShared</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> releases) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (;;) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> current </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getState</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> next </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> current </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> releases;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (next </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> current) </span><span style="color:#6A737D;">// overflow</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Maximum permit count exceeded&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">compareAndSetState</span><span style="color:#E1E4E8;">(current, next))</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">protected</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">tryReleaseShared</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> releases) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (;;) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> current </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getState</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> next </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> current </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> releases;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (next </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> current) </span><span style="color:#6A737D;">// overflow</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Error</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Maximum permit count exceeded&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">compareAndSetState</span><span style="color:#24292E;">(current, next))</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h1 id="原子操作" tabindex="-1">原子操作 <a class="header-anchor" href="#原子操作" aria-label="Permalink to &quot;原子操作&quot;">​</a></h1><p>​ 当在多线程情况下，同时更新一个共享变量，由于我们前面讲过的原子性问题，可能得不到预期的结果。如果要达到期望的结果，可以通过 synchronized 来加锁解决，因为 synchronized 会保证多线程对共享变量的访问进行排队。</p><p>​ 在 Java5 以后，提供了原子操作类，这些原子操作类提供了一种简单、高效以及线程安全的更新操作。而由于变量的类型很多，所以 Atomic 一共提供了12个类分别对应四种类型的原子更新操作，基本类型、数组类型、引用类型、属性类型。</p><p>基本类型对应：<code>AtomicBoolean</code>、<code>AtomicInteger</code>、<code>AtomicLong</code></p><p>数组类型对应：<code>AtomicIntegerArray</code>、<code>AtomicLongArray</code>、<code>AtomicReferenceArray</code></p><p>引用类型对应：<code>AtomicReference</code>、<code>AtomicReferenceFieldUpdater</code>、<code>AtomicMarkableReference</code></p><p>字段类型对应：<code>AtomicIntegerFieldUpdater</code>、<code>AtomicLongFieldUpdater</code>、<code>AtomicStampedReference</code></p><h2 id="atomic-原子操作的使用" tabindex="-1">Atomic 原子操作的使用 <a class="header-anchor" href="#atomic-原子操作的使用" aria-label="Permalink to &quot;Atomic 原子操作的使用&quot;">​</a></h2><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> AtomicInteger count</span><span style="color:#F97583;">=new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">AtomicInteger</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">synchronized</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">inc</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        Thread.</span><span style="color:#B392F0;">sleep</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (InterruptedException </span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        e.</span><span style="color:#B392F0;">printStackTrace</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    count.</span><span style="color:#B392F0;">getAndIncrement</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] args) throws InterruptedException {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> i</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;i</span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;">;i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">){</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Thread</span><span style="color:#E1E4E8;">(()</span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            SafeDemo.</span><span style="color:#B392F0;">inc</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }).</span><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    Thread.</span><span style="color:#B392F0;">sleep</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">4000</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    System.out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(count.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">());</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> AtomicInteger count</span><span style="color:#D73A49;">=new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">AtomicInteger</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">synchronized</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">inc</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        Thread.</span><span style="color:#6F42C1;">sleep</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (InterruptedException </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        e.</span><span style="color:#6F42C1;">printStackTrace</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    count.</span><span style="color:#6F42C1;">getAndIncrement</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] args) throws InterruptedException {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;i</span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">1000</span><span style="color:#24292E;">;i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">){</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Thread</span><span style="color:#24292E;">(()</span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            SafeDemo.</span><span style="color:#6F42C1;">inc</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        }).</span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    Thread.</span><span style="color:#6F42C1;">sleep</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">4000</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    System.out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(count.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">());</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="atomicinteger实现原理" tabindex="-1">AtomicInteger实现原理 <a class="header-anchor" href="#atomicinteger实现原理" aria-label="Permalink to &quot;AtomicInteger实现原理&quot;">​</a></h2><p>由于所有的原子操作类都是大同小异的，所以我们只分析其中一个原子操作类</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getAndIncrement</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> unsafe.</span><span style="color:#B392F0;">getAndAddInt</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">, valueOffset, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getAndIncrement</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> unsafe.</span><span style="color:#6F42C1;">getAndAddInt</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">, valueOffset, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>大家又会发现一些熟悉的东西，就是unsafe。调用unsafe类中的getAndAddInt方法，这个方法如下。</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getAndAddInt</span><span style="color:#E1E4E8;">(Object var1, </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> var2, </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> var4) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> var5;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">do</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        var5 </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">getIntVolatile</span><span style="color:#E1E4E8;">(var1, var2);</span><span style="color:#6A737D;">// 方法获取对象中offset偏移地址对应的整型 field 的值</span></span>
<span class="line"><span style="color:#E1E4E8;">    } </span><span style="color:#F97583;">while</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">!</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">compareAndSwapInt</span><span style="color:#E1E4E8;">(var1, var2, var5, var5 </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> var4));</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> var5;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getAndAddInt</span><span style="color:#24292E;">(Object var1, </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> var2, </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> var4) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> var5;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">do</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        var5 </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">getIntVolatile</span><span style="color:#24292E;">(var1, var2);</span><span style="color:#6A737D;">// 方法获取对象中offset偏移地址对应的整型 field 的值</span></span>
<span class="line"><span style="color:#24292E;">    } </span><span style="color:#D73A49;">while</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">!</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">compareAndSwapInt</span><span style="color:#24292E;">(var1, var2, var5, var5 </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> var4));</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> var5;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>​ 通过循环以及cas的方式实现原子更新，从而达到在多线程情况下仍然能够保证原子性的目的。</p><p>大家会发现，只要基本的东西搞明白以后，剩下的都比较容易理解了。</p><h1 id="线程池" tabindex="-1">线程池 <a class="header-anchor" href="#线程池" aria-label="Permalink to &quot;线程池&quot;">​</a></h1><p>​ Java中的线程池是使用场景最多的并发框架，几乎所有需要异步或并发执行任务的程序都可以使用线程池。线程池就像数据库连接池（ druid ）的作用类似，只是线程池是用来重复管理线程避免创建大量线程增加开销。所以合理地使用线程池可以有以下的好处</p><ol><li>降低创建线程和销毁线程的性能开销</li><li>合理地设置线程池大小可以避免因为线程数超出硬件资源瓶颈带来的问题，类似起到了限流的作用；线程是稀缺资源，如果无限创建，会造成系统稳定性问题</li></ol><h2 id="线程池的使用" tabindex="-1">线程池的使用 <a class="header-anchor" href="#线程池的使用" aria-label="Permalink to &quot;线程池的使用&quot;">​</a></h2><p>​ <strong>JDK</strong> 为我们内置了几种常见线程池的实现，均可以使用 <code>Executsors</code> 工厂类创建为了更好地控制多线程， <strong>JDK</strong> 提供了一套线程框架 <code>Executor</code> ，帮助开发人员有效地进行线程控制。它们都在 <code>java.util.concurrent</code> 包中，是 <code>JDK</code> 并发包的核心。</p><p>​ 其中有一个比较重要的类: <code>Executors</code> ，他扮演着线程工厂的角色，我们通过 Executors 可以创建特定功能的线程池</p><p><strong>newFixedThreadPool</strong> ：该方法返回一个固定数量的线程池，线程数不变，当有一个任务提交时，若线程池中空闲，则立即执行，若没有，则会被暂缓在一个任务队列中，等待有空闲的线程去执行。</p><p><strong>newSingleThreadExecutor</strong> : 创建一个线程的线程池，若空闲则执行，若没有空闲线程则暂缓在任务队列中。</p><p><strong>newCachedThreadPool</strong> ：返回一个可根据实际情况调整线程个数的线程池，不限制最大线程数量，若用空闲的线程则执行任务，若无任务则不创建线程。并且每一个空闲线程会在60秒后自动回收。</p><p><strong>newScheduledThreadPool</strong> : 创建一个可以指定线程的数量的线程池，但是这个线程池还带有延迟和周期性执行任务的功能，类似定时器。</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">@</span><span style="color:#F97583;">RequiredArgsConstructor</span></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ThreadPoolDemo</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Thread</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> i ;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> ExecutorService executorService</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Executors.</span><span style="color:#B392F0;">newFixedThreadPool</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">run</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            Thread.</span><span style="color:#B392F0;">sleep</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (InterruptedException </span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            e.</span><span style="color:#B392F0;">printStackTrace</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        out.</span><span style="color:#B392F0;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;[&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> Thread.</span><span style="color:#B392F0;">currentThread</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">getName</span><span style="color:#E1E4E8;">() </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;]:&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> i);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] </span><span style="color:#FFAB70;">args</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            executorService.</span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ThreadPoolDemo</span><span style="color:#E1E4E8;">(i));</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">        executorService.</span><span style="color:#B392F0;">shutdown</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">@</span><span style="color:#D73A49;">RequiredArgsConstructor</span></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPoolDemo</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Thread</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i ;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> ExecutorService executorService</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Executors.</span><span style="color:#6F42C1;">newFixedThreadPool</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">run</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            Thread.</span><span style="color:#6F42C1;">sleep</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (InterruptedException </span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            e.</span><span style="color:#6F42C1;">printStackTrace</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        out.</span><span style="color:#6F42C1;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;[&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> Thread.</span><span style="color:#6F42C1;">currentThread</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getName</span><span style="color:#24292E;">() </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;]:&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> i);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] </span><span style="color:#E36209;">args</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            executorService.</span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPoolDemo</span><span style="color:#24292E;">(i));</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">        executorService.</span><span style="color:#6F42C1;">shutdown</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>设置了3个固定线程大小的线程池来跑100</p><div class="language-verilog vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">verilog</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// ........</span></span>
<span class="line"><span style="color:#E1E4E8;">[pool</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">thread</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">]:</span><span style="color:#79B8FF;">95</span></span>
<span class="line"><span style="color:#E1E4E8;">[pool</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">thread</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">]:</span><span style="color:#79B8FF;">98</span></span>
<span class="line"><span style="color:#E1E4E8;">[pool</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">thread</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]:</span><span style="color:#79B8FF;">97</span></span>
<span class="line"><span style="color:#E1E4E8;">[pool</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">thread</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">]:</span><span style="color:#79B8FF;">96</span></span>
<span class="line"><span style="color:#E1E4E8;">[pool</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">thread</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]:</span><span style="color:#79B8FF;">100</span></span>
<span class="line"><span style="color:#E1E4E8;">[pool</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">thread</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">]:</span><span style="color:#79B8FF;">99</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// ........</span></span>
<span class="line"><span style="color:#24292E;">[pool</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">thread</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">]:</span><span style="color:#005CC5;">95</span></span>
<span class="line"><span style="color:#24292E;">[pool</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">thread</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">]:</span><span style="color:#005CC5;">98</span></span>
<span class="line"><span style="color:#24292E;">[pool</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">thread</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]:</span><span style="color:#005CC5;">97</span></span>
<span class="line"><span style="color:#24292E;">[pool</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">thread</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">]:</span><span style="color:#005CC5;">96</span></span>
<span class="line"><span style="color:#24292E;">[pool</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">thread</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]:</span><span style="color:#005CC5;">100</span></span>
<span class="line"><span style="color:#24292E;">[pool</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">thread</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">]:</span><span style="color:#005CC5;">99</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="submit-和-execute-的区别" tabindex="-1"><code>submit</code> 和 <code>execute</code> 的区别 <a class="header-anchor" href="#submit-和-execute-的区别" aria-label="Permalink to &quot;`submit` 和 `execute` 的区别&quot;">​</a></h3><p>执行一个任务，可以使用 <code>submit</code> 和 <code>execute</code> ，这两者有什么区别呢？</p><ol><li><code>execute</code> 只能接受 <code>Runnable</code> 类型的任务</li><li><code>submit</code> 不管是 <code>Runnable</code> 还是 <code>Callable</code> 类型的任务都可以接受，但是 <code>Runnable</code> 返回值均为 <code>void</code> ，所以使用 <code>Future</code> 的 <code>get()</code> 获得的还是 <strong>null</strong></li></ol><h2 id="threadpoolexecutor" tabindex="-1"><code>ThreadpoolExecutor</code> <a class="header-anchor" href="#threadpoolexecutor" aria-label="Permalink to &quot;`ThreadpoolExecutor`&quot;">​</a></h2><p>​ 前面说的四种线程池构建工具，都是基于<code>ThreadPoolExecutor</code> 类，它的构造函数参数分别看一下前面提到的几个初始化工具类的构造以及原理</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ThreadPoolExecutor</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> corePoolSize, </span><span style="color:#6A737D;">//核心线程数量</span></span>
<span class="line"><span style="color:#E1E4E8;">                          </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> maximumPoolSize, </span><span style="color:#6A737D;">//最大线程数</span></span>
<span class="line"><span style="color:#E1E4E8;">                          </span><span style="color:#F97583;">long</span><span style="color:#E1E4E8;"> keepAliveTime, </span><span style="color:#6A737D;">//超时时间,超出核心线程数量以外的线程空余存活时间</span></span>
<span class="line"><span style="color:#E1E4E8;">                          TimeUnit unit, </span><span style="color:#6A737D;">//存活时间单位</span></span>
<span class="line"><span style="color:#E1E4E8;">                          BlockingQueue</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">Runnable</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> workQueue, </span><span style="color:#6A737D;">//保存执行任务的队列</span></span>
<span class="line"><span style="color:#E1E4E8;">                          ThreadFactory threadFactory,</span><span style="color:#6A737D;">//创建新线程使用的工厂</span></span>
<span class="line"><span style="color:#E1E4E8;">                          RejectedExecutionHandler handler </span><span style="color:#6A737D;">//当任务无法执行的时候的处理方式</span></span>
<span class="line"><span style="color:#E1E4E8;">                         ) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</span></span>
<span class="line"><span style="color:#E1E4E8;">         Executors.</span><span style="color:#B392F0;">defaultThreadFactory</span><span style="color:#E1E4E8;">(), defaultHandler);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPoolExecutor</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> corePoolSize, </span><span style="color:#6A737D;">//核心线程数量</span></span>
<span class="line"><span style="color:#24292E;">                          </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> maximumPoolSize, </span><span style="color:#6A737D;">//最大线程数</span></span>
<span class="line"><span style="color:#24292E;">                          </span><span style="color:#D73A49;">long</span><span style="color:#24292E;"> keepAliveTime, </span><span style="color:#6A737D;">//超时时间,超出核心线程数量以外的线程空余存活时间</span></span>
<span class="line"><span style="color:#24292E;">                          TimeUnit unit, </span><span style="color:#6A737D;">//存活时间单位</span></span>
<span class="line"><span style="color:#24292E;">                          BlockingQueue</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">Runnable</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> workQueue, </span><span style="color:#6A737D;">//保存执行任务的队列</span></span>
<span class="line"><span style="color:#24292E;">                          ThreadFactory threadFactory,</span><span style="color:#6A737D;">//创建新线程使用的工厂</span></span>
<span class="line"><span style="color:#24292E;">                          RejectedExecutionHandler handler </span><span style="color:#6A737D;">//当任务无法执行的时候的处理方式</span></span>
<span class="line"><span style="color:#24292E;">                         ) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</span></span>
<span class="line"><span style="color:#24292E;">         Executors.</span><span style="color:#6F42C1;">defaultThreadFactory</span><span style="color:#24292E;">(), defaultHandler);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="newfixedthreadpool" tabindex="-1">newFixedThreadPool <a class="header-anchor" href="#newfixedthreadpool" aria-label="Permalink to &quot;newFixedThreadPool&quot;">​</a></h3><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> ExecutorService </span><span style="color:#B392F0;">newFixedThreadPool</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> nThreads) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ThreadPoolExecutor</span><span style="color:#E1E4E8;">(nThreads, nThreads,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#79B8FF;">0L</span><span style="color:#E1E4E8;">, TimeUnit.MILLISECONDS,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> LinkedBlockingQueue&lt;</span><span style="color:#F97583;">Runnable</span><span style="color:#E1E4E8;">&gt;());</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> ExecutorService </span><span style="color:#6F42C1;">newFixedThreadPool</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> nThreads) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPoolExecutor</span><span style="color:#24292E;">(nThreads, nThreads,</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#005CC5;">0L</span><span style="color:#24292E;">, TimeUnit.MILLISECONDS,</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> LinkedBlockingQueue&lt;</span><span style="color:#D73A49;">Runnable</span><span style="color:#24292E;">&gt;());</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>​ <code>FixedThreadPool</code> 的核心线程数和最大线程数都是指定值，也就是说当线程池中的线程数超过核心线程数后，任务都会被放到阻塞队列中。另外 keepAliveTime 为 0，也就是超出核心线程数量以外的线程空余存活时间。</p><p>​ 而这里选用的阻塞队列是 <code>LinkedBlockingQueue</code>，使用的是默认容量 <code>Integer.MAX_VALUE</code>，相当于没有上限</p><p>这个线程池执行任务的流程如下：</p><ol><li>线程数少于核心线程数，也就是设置的线程数时，新建线程执行任务</li><li>线程数等于核心线程数后，将任务加入阻塞队列</li><li>由于队列容量非常大，可以一直添加</li><li>执行完任务的线程反复去队列中取任务执行</li></ol><p>用途：FixedThreadPool 用于负载比较大的服务器，为了资源的合理利用，需要限制当前线程数量</p><h3 id="newcachedthreadpool" tabindex="-1">newCachedThreadPool <a class="header-anchor" href="#newcachedthreadpool" aria-label="Permalink to &quot;newCachedThreadPool&quot;">​</a></h3><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> ExecutorService </span><span style="color:#B392F0;">newCachedThreadPool</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ThreadPoolExecutor</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">                                  Integer.MAX_VALUE,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#79B8FF;">60L</span><span style="color:#E1E4E8;">, TimeUnit.SECONDS,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> SynchronousQueue&lt;</span><span style="color:#F97583;">Runnable</span><span style="color:#E1E4E8;">&gt;());  </span><span style="color:#6A737D;">// 不存数据的队列</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> ExecutorService </span><span style="color:#6F42C1;">newCachedThreadPool</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPoolExecutor</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">                                  Integer.MAX_VALUE,</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#005CC5;">60L</span><span style="color:#24292E;">, TimeUnit.SECONDS,</span></span>
<span class="line"><span style="color:#24292E;">                                  </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> SynchronousQueue&lt;</span><span style="color:#D73A49;">Runnable</span><span style="color:#24292E;">&gt;());  </span><span style="color:#6A737D;">// 不存数据的队列</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>​ CachedThreadPool 创建一个可缓存线程池，如果线程池长度超过处理需要，可灵活回收空闲线程，若无可回收，则新建线程；并且没有核心线程，非核心线程数无上限，但是每个空闲的时间只有 60 秒，超过后就会被回收。 它的执行流程如下：</p><ol><li>没有核心线程，直接向 SynchronousQueue 中提交任务</li><li>如果有空闲线程，就去取出任务执行；如果没有空闲线程，就新建一个</li><li>执行完任务的线程有 60 秒生存时间，如果在这个时间内可以接到新任务，就可以继续活下去，否则就被回收</li></ol><h3 id="newsinglethreadexecutor" tabindex="-1">newSingleThreadExecutor <a class="header-anchor" href="#newsinglethreadexecutor" aria-label="Permalink to &quot;newSingleThreadExecutor&quot;">​</a></h3><p>​ 创建一个单线程化的线程池，它只会用唯一的工作线程来执行任务，保证所有任务按照指定顺序(FIFO, LIFO, 优先级)执行</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> ExecutorService </span><span style="color:#B392F0;">newSingleThreadExecutor</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> FinalizableDelegatedExecutorService</span></span>
<span class="line"><span style="color:#E1E4E8;">            (</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ThreadPoolExecutor</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,  </span><span style="color:#6A737D;">// 只有一个线程的线程池</span></span>
<span class="line"><span style="color:#E1E4E8;">                                    </span><span style="color:#79B8FF;">0L</span><span style="color:#E1E4E8;">, TimeUnit.MILLISECONDS,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                    </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> LinkedBlockingQueue&lt;</span><span style="color:#F97583;">Runnable</span><span style="color:#E1E4E8;">&gt;()));</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> ExecutorService </span><span style="color:#6F42C1;">newSingleThreadExecutor</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> FinalizableDelegatedExecutorService</span></span>
<span class="line"><span style="color:#24292E;">            (</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ThreadPoolExecutor</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,  </span><span style="color:#6A737D;">// 只有一个线程的线程池</span></span>
<span class="line"><span style="color:#24292E;">                                    </span><span style="color:#005CC5;">0L</span><span style="color:#24292E;">, TimeUnit.MILLISECONDS,</span></span>
<span class="line"><span style="color:#24292E;">                                    </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> LinkedBlockingQueue&lt;</span><span style="color:#D73A49;">Runnable</span><span style="color:#24292E;">&gt;()));</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="线程池的源码分析" tabindex="-1">线程池的源码分析 <a class="header-anchor" href="#线程池的源码分析" aria-label="Permalink to &quot;线程池的源码分析&quot;">​</a></h2><p><code>ThreadPoolExecutor</code> 是线程池的核心，提供了线程池的实现。</p><p>​ ScheduledThreadPoolExecutor继承了ThreadPoolExecutor，并另外提供一些调度方法以支持定时和周期任务。Executers是工具类，主要用来创建线程池对象。</p><p>​ 我们把一个任务提交给线程池去处理的时候，线程池的处理过程是什么样的呢？首先直接来看看定义。</p><h3 id="线程数量和线程池状态管理" tabindex="-1">线程数量和线程池状态管理 <a class="header-anchor" href="#线程数量和线程池状态管理" aria-label="Permalink to &quot;线程数量和线程池状态管理&quot;">​</a></h3><p>​ 线程池用一个 AtomicInteger 来保存 [线程数量] 和 [线程池状态] ,一个int数值一共有32位,高3位用于保存运行状态, 低29位用于保存线程数量</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> AtomicInteger ctl </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">AtomicInteger</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">ctlOf</span><span style="color:#E1E4E8;">(RUNNING, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)); </span><span style="color:#6A737D;">//一个原子操作类</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> COUNT_BITS </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> Integer.SIZE </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">//32-3</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> CAPACITY </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> COUNT_BITS) </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">//将1的二进制向右位移29位,再减1表示最大线程容量</span></span>
<span class="line"><span style="color:#6A737D;">//运行状态保存在int值的高3位 (所有数值左移29位)</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> RUNNING </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> COUNT_BITS;</span><span style="color:#6A737D;">// 接收新任务,并执行队列中的任务</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> SHUTDOWN </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> COUNT_BITS;</span><span style="color:#6A737D;">// 不接收新任务,但是执行队列中的任务</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> STOP </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> COUNT_BITS;</span><span style="color:#6A737D;">// 不接收新任务,不执行队列中的任务,中断正在执行中的任务</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> TIDYING </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> COUNT_BITS; </span><span style="color:#6A737D;">//所有的任务都已结束,线程数量为0,处于该状态的线程池即将调用terminated()方法</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> TERMINATED </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> COUNT_BITS;</span><span style="color:#6A737D;">// terminated()方法执行完成</span></span>
<span class="line"><span style="color:#6A737D;">// Packing and unpacking ctl</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">runStateOf</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> c) { </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> c </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">CAPACITY; } </span><span style="color:#6A737D;">//获取运行状态</span></span>
<span class="line"><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">workerCountOf</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> c) { </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> c </span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;"> CAPACITY; } </span><span style="color:#6A737D;">//获取线程数量</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> AtomicInteger ctl </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">AtomicInteger</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">ctlOf</span><span style="color:#24292E;">(RUNNING, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)); </span><span style="color:#6A737D;">//一个原子操作类</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> COUNT_BITS </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> Integer.SIZE </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">//32-3</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> CAPACITY </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> COUNT_BITS) </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">//将1的二进制向右位移29位,再减1表示最大线程容量</span></span>
<span class="line"><span style="color:#6A737D;">//运行状态保存在int值的高3位 (所有数值左移29位)</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> RUNNING </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> COUNT_BITS;</span><span style="color:#6A737D;">// 接收新任务,并执行队列中的任务</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> SHUTDOWN </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> COUNT_BITS;</span><span style="color:#6A737D;">// 不接收新任务,但是执行队列中的任务</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> STOP </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> COUNT_BITS;</span><span style="color:#6A737D;">// 不接收新任务,不执行队列中的任务,中断正在执行中的任务</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> TIDYING </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> COUNT_BITS; </span><span style="color:#6A737D;">//所有的任务都已结束,线程数量为0,处于该状态的线程池即将调用terminated()方法</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> TERMINATED </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> COUNT_BITS;</span><span style="color:#6A737D;">// terminated()方法执行完成</span></span>
<span class="line"><span style="color:#6A737D;">// Packing and unpacking ctl</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">runStateOf</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> c) { </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> c </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">CAPACITY; } </span><span style="color:#6A737D;">//获取运行状态</span></span>
<span class="line"><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">workerCountOf</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> c) { </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> c </span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;"> CAPACITY; } </span><span style="color:#6A737D;">//获取线程数量</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="execute" tabindex="-1">execute <a class="header-anchor" href="#execute" aria-label="Permalink to &quot;execute&quot;">​</a></h3><p>​ 通过线程池的核心方法了解线程池中这些参数的含义</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">execute</span><span style="color:#E1E4E8;">(Runnable command) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (command </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">throw</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NullPointerException</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> c </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ctl.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">workerCountOf</span><span style="color:#E1E4E8;">(c) </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> corePoolSize) {</span><span style="color:#6A737D;">//1.当前池中线程比核心数少，新建一个线程执行任务</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">addWorker</span><span style="color:#E1E4E8;">(command, </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">))</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        c </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ctl.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">isRunning</span><span style="color:#E1E4E8;">(c) </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> workQueue.</span><span style="color:#B392F0;">offer</span><span style="color:#E1E4E8;">(command)) {</span><span style="color:#6A737D;">//2.核心池已满，但任务队列未满，添加到队列中</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> recheck </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ctl.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">//任务成功添加到队列以后，再次检查是否需要添加新的线程，因为已存在的线程可能被销毁了</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">isRunning</span><span style="color:#E1E4E8;">(recheck) </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">remove</span><span style="color:#E1E4E8;">(command))</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">reject</span><span style="color:#E1E4E8;">(command);</span><span style="color:#6A737D;">//如果线程池处于非运行状态，并且把当前的任务从任务队列中移除成功，则拒绝该任务</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">workerCountOf</span><span style="color:#E1E4E8;">(recheck) </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)</span><span style="color:#6A737D;">//如果之前的线程已被销毁完，新建一个线程</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">addWorker</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#B392F0;">addWorker</span><span style="color:#E1E4E8;">(command, </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">)) </span><span style="color:#6A737D;">//3.核心池已满，队列已满，试着创建一个新线程</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">reject</span><span style="color:#E1E4E8;">(command); </span><span style="color:#6A737D;">//如果创建新线程失败了，说明线程池被关闭或者线程池完全满了，拒绝任务</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">execute</span><span style="color:#24292E;">(Runnable command) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (command </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">throw</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NullPointerException</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> c </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ctl.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">workerCountOf</span><span style="color:#24292E;">(c) </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> corePoolSize) {</span><span style="color:#6A737D;">//1.当前池中线程比核心数少，新建一个线程执行任务</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">addWorker</span><span style="color:#24292E;">(command, </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">))</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        c </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ctl.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">isRunning</span><span style="color:#24292E;">(c) </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> workQueue.</span><span style="color:#6F42C1;">offer</span><span style="color:#24292E;">(command)) {</span><span style="color:#6A737D;">//2.核心池已满，但任务队列未满，添加到队列中</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> recheck </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ctl.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">//任务成功添加到队列以后，再次检查是否需要添加新的线程，因为已存在的线程可能被销毁了</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">isRunning</span><span style="color:#24292E;">(recheck) </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">remove</span><span style="color:#24292E;">(command))</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">reject</span><span style="color:#24292E;">(command);</span><span style="color:#6A737D;">//如果线程池处于非运行状态，并且把当前的任务从任务队列中移除成功，则拒绝该任务</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">workerCountOf</span><span style="color:#24292E;">(recheck) </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)</span><span style="color:#6A737D;">//如果之前的线程已被销毁完，新建一个线程</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">addWorker</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#6F42C1;">addWorker</span><span style="color:#24292E;">(command, </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">)) </span><span style="color:#6A737D;">//3.核心池已满，队列已满，试着创建一个新线程</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">reject</span><span style="color:#24292E;">(command); </span><span style="color:#6A737D;">//如果创建新线程失败了，说明线程池被关闭或者线程池完全满了，拒绝任务</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="/assets/JavaGuide_并发编程_并发框架_Executor线程池.c1f40495.png" alt="JavaGuide_并发编程_并发框架_Executor线程池.png"></p><h3 id="流程图" tabindex="-1">流程图 <a class="header-anchor" href="#流程图" aria-label="Permalink to &quot;流程图&quot;">​</a></h3><p><img src="/assets/JavaGuide_并发编程_并发框架_线程池添加的过程.60f6c2de.png" alt="JavaGuide_并发编程_并发框架_线程池添加的过程.png"></p><p><img src="/assets/JavaGuide_并发编程_并发框架_线程池执行的过程.33321000.png" alt="JavaGuide_并发编程_并发框架_线程池执行的过程.png"></p><h5 id="threadpoolexecutor-1" tabindex="-1"><code>ThreadPoolExecutor</code> <a class="header-anchor" href="#threadpoolexecutor-1" aria-label="Permalink to &quot;`ThreadPoolExecutor`&quot;">​</a></h5><ul><li><p>它为什么要用独占锁？</p><p>答：他正在运行的线程不应该中断。独占锁的目的。线程的数量可以中途去控制的。</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    ThreadPoolExecutor tpe </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ThreadPoolExecutor.class.</span><span style="color:#B392F0;">cast</span><span style="color:#E1E4E8;">(executorService);</span></span>
<span class="line"><span style="color:#E1E4E8;">    tpe.</span><span style="color:#B392F0;">setCorePoolSize</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">222</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    ThreadPoolExecutor tpe </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ThreadPoolExecutor.class.</span><span style="color:#6F42C1;">cast</span><span style="color:#24292E;">(executorService);</span></span>
<span class="line"><span style="color:#24292E;">    tpe.</span><span style="color:#6F42C1;">setCorePoolSize</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">222</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p>他利用一个一个 <code>worker</code> 来达到线程复用的目的。</p></li></ul><h3 id="异常处理" tabindex="-1">异常处理： <a class="header-anchor" href="#异常处理" aria-label="Permalink to &quot;异常处理：&quot;">​</a></h3><ul><li>AbortPolicy ：直接抛异常</li><li>CallerRunsPolicy ： 用调用者所在的线程来执行任务</li><li>DiscardOldestPolicy ： 丢弃阻塞队列中最靠前的队伍，并执行当前任务</li><li>DiscardPolicy ： 直接丢掉</li></ul><h3 id="类型" tabindex="-1">类型 <a class="header-anchor" href="#类型" aria-label="Permalink to &quot;类型&quot;">​</a></h3><ul><li>CPU 密集型（尽可能小）</li><li>IO 密集型 （按照 CPU 核心数的倍数去设置）</li><li>混合型</li></ul><p>任务执行的时间</p><p>队列的选择和队列的大小（容易让系统爆掉）</p><blockquote><p>​ 假如 CPU 的线程只有 4 个，而创建的线程有 40 个， 400 个，它会造成任务的大量的上下文切换，会有大量的消耗</p><p>​ IO 密集型，按照 CPU 的核心的倍数去设置，可以充分地利用 CPU，</p></blockquote><blockquote><ol><li>高并发、任务执行时间短的业务，线程池线程数可以设置为CPU核数+1，减少线程上下文的切换</li><li>并发不高、任务执行时间长的业务要区分开看： <ul><li>假如是业务时间长期集中在IO操作上，也就是IO密集型的任务，因为IO操作并不占用CPU，所以不要让所有的CPU闲下来，可以加大线程池中的线程数目，让CPU处理更多的业务</li><li>假如是业务时间长期集中在计算操作上，也就是计算密集型任务，这个就没办法了，和（1）一样吧，线程池中的线程数设置得少一些，减少线程上下文的切换</li></ul></li><li>并发高、业务执行时间长，解决这种类型任务的关键不在于线程池而在于整体架构的设计，看看这些业务里面某些数据是否能做缓存是第一步，增加服务器是第二步，至于线程池的设置，设置参考（2）。最后，业务执行时间长的问题，也可能需要分析一下，看看能不能使用中间件对任务进行拆分和解耦。</li></ol></blockquote><h2 id="线程的监控" tabindex="-1">线程的监控 <a class="header-anchor" href="#线程的监控" aria-label="Permalink to &quot;线程的监控&quot;">​</a></h2><ul><li>JVM 层面的东西 Synchronized wait / notify</li><li>JDK: ( Lock 、CountDownLatch、FutureTask、... ... ) AQS 实现的 （ AQS 队列， Condition 队列 ）</li></ul><p>cxq / waitSet / entryList</p><p>JVM 基于 cxq， JDK 基于 AQS</p></div></div></main><footer class="VPDocFooter" data-v-407ae146 data-v-db06e8b7><!--[--><!--[--><!--[--><!--[--><div class="ProductPage" style="margin-bottom:24px;" data-v-a79f6019><!--[--><section class="ProductPageSection" data-v-a79f6019-s data-v-681abbe2><div class="title" data-v-681abbe2><div class="title-line" data-v-681abbe2></div><!----></div><!----><div class="members" data-v-681abbe2><!--[--><div class="ProductMembers small count-3" data-v-25f9d112><div class="container" data-v-25f9d112><!--[--><div class="item" data-v-25f9d112><article class="ProductMembersItem small" data-v-25f9d112 data-v-c93a5291><div class="profile" data-v-c93a5291><figure class="avatar" data-v-c93a5291><img class="avatar-img" src="/qrimg/QQ/QQ.png" alt="QQ号" data-v-c93a5291></figure><div class="data" data-v-c93a5291><p class="name" data-v-c93a5291>QQ号</p><p class="affiliation" data-v-c93a5291><span class="title" data-v-c93a5291>扫码联系我购买</span><!----><!----></p><!----></div></div><div class="sp" data-v-c93a5291><!----></div></article></div><div class="item" data-v-25f9d112><article class="ProductMembersItem small" data-v-25f9d112 data-v-c93a5291><div class="profile" data-v-c93a5291><figure class="avatar" data-v-c93a5291><img class="avatar-img" src="/qrimg/wxpublic/out/01.png" alt="微信公众号" data-v-c93a5291></figure><div class="data" data-v-c93a5291><p class="name" data-v-c93a5291>微信公众号</p><p class="affiliation" data-v-c93a5291><span class="title" data-v-c93a5291>扫描关注微信公众号</span><!----><!----></p><!----></div></div><!----></article></div><div class="item" data-v-25f9d112><article class="ProductMembersItem small" data-v-25f9d112 data-v-c93a5291><div class="profile" data-v-c93a5291><figure class="avatar" data-v-c93a5291><img class="avatar-img" src="/qrimg/educode/out/06.png" alt="免费的编程小资料" data-v-c93a5291></figure><div class="data" data-v-c93a5291><p class="name" data-v-c93a5291>免费的编程小资料</p><p class="affiliation" data-v-c93a5291><span class="title" data-v-c93a5291>扫码或点击查询</span><!----><!----></p><!----></div></div><div class="sp" data-v-c93a5291><!----></div></article></div><!--]--></div></div><!--]--></div></section><!--]--></div><!--]--><!--]--><!--]--><!--]--><div class="edit-info" data-v-db06e8b7><!----><div class="last-updated" data-v-db06e8b7><p class="VPLastUpdated" data-v-db06e8b7 data-v-5e5d954f>更新时间: <time datetime="2025-03-11T04:34:52.000Z" data-v-5e5d954f></time></p></div></div><nav class="prev-next" data-v-db06e8b7><div class="pager" data-v-db06e8b7><a class="pager-link prev" href="/%E7%99%BE%E4%B8%87%E6%9E%B6%E6%9E%84%E5%B8%88/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9A%84%E5%8E%9F%E7%90%86(%E4%B8%89).html" data-v-db06e8b7><span class="desc" data-v-db06e8b7>上一篇</span><span class="title" data-v-db06e8b7>并发编程的原理(三)</span></a></div><div class="pager" data-v-db06e8b7><!----></div></nav></footer><!--[--><!--[--><!--[--><main class="footer"><br><section class="VPTeamPageSection" data-v-be77a509><div class="title" data-v-be77a509><div class="title-line" data-v-be77a509></div><h2 class="title-text" data-v-be77a509><!--[-->friends<!--]--></h2></div><!----><!----></section><div class="actions"><!--[--><div class="action"><a class="VPButton medium sponsor" href="http://nogeek.cn" target="_blank" rel="noreferrer" data-v-67f1efab>不止极客</a></div><div class="action"><a class="VPButton medium sponsor" href="http://codeedu.cn" target="_blank" rel="noreferrer" data-v-67f1efab>codeedu</a></div><div class="action"><a class="VPButton medium sponsor" href="http://educode.cn" target="_blank" rel="noreferrer" data-v-67f1efab>educode</a></div><div class="action"><a class="VPButton medium sponsor" href="http://UMLcn.com" target="_blank" rel="noreferrer" data-v-67f1efab>UMLcn</a></div><!--]--></div><br><section class="VPTeamPageSection" data-v-be77a509><div class="title" data-v-be77a509><div class="title-line" data-v-be77a509></div><!----></div><!----><!----></section><br></main><div><div align="center"><a class="VPButton big sponsor" data-v-67f1efab>复制链接</a></div><!----></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-4b25b801 data-v-700bb36c><div class="container" data-v-700bb36c><p class="message" data-v-700bb36c><a href="http://educode.cn" target="_blank" style="color: #337ab7; text-decoration: underline">educode.cn</a>&nbsp &nbsp<a href="http://codeedu.cn" target="_blank" style="color: #337ab7; text-decoration: underline">codeedu.cn</a>&nbsp &nbsp<a href="http://notgeek.cn" target="_blank" style="color: #337ab7; text-decoration: underline">notgeek.cn</a>&nbsp &nbsp<br/><br/> Released under the MIT License.</p><p class="copyright" data-v-700bb36c>Copyright © 2023-present <a href="http://nogeek.cn" target="_blank" style="color: #337ab7; text-decoration: underline"> noGeek.cn </a> <br/><a href="https://beian.miit.gov.cn/" target="_blank" style="color: #337ab7;"> 豫ICP备20012533号-6 </a> </p></div></footer><!--[--><!--]--></div></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"百万架构师_spring 源码分析_手写springmvc2.0版本.md\":\"8cbfb210\",\"百万架构师_rabbitmq_可靠性投递和实践经验.md\":\"31f37d03\",\"百万架构师_rabbitmq_高可用集群搭建步骤.md\":\"f59b3d95\",\"百万架构师_spring 源码分析_springmvc核心原理及源码分析.md\":\"b94a97d3\",\"百万架构师_spring 源码分析_spring系统概述及ioc实现原理.md\":\"c1c0d2e9\",\"百万架构师_spring 源码分析_手写mini版spring1.0版.md\":\"a74338eb\",\"百万架构师_spring 源码分析_手写springaop核心原理.md\":\"2a7028f0\",\"百万架构师_spring 源码分析_手写springioc核心代码.md\":\"df665a78\",\"百万架构师_rabbitmq_linux安装rabbitmq.md\":\"d060d3a0\",\"百万架构师_kafka_分布式消息通信kafka(二).md\":\"9431f3a0\",\"百万架构师_spring 源码分析_spring经典面试答疑.md\":\"79d3c495\",\"百万架构师_分布式架构的基础_分布式系统的基石tcp-ip通讯协议.md\":\"6e8c304e\",\"百万架构师_rmi_分布式通讯框架rmi的原理.md\":\"525ff128\",\"百万架构师_rabbitmq_rabbitmq-工作模型与java编程.md\":\"04cc48e6\",\"百万架构师_rabbitmq_windows安装rabbitmq.md\":\"e287f9b5\",\"百万架构师_分布式架构的基础_分布式系统的基石http协议与https协议.md\":\"d2ac8cb3\",\"links.md\":\"db513e16\",\"百万架构师_并发编程_并发编程的原理(一).md\":\"fdfe4b1c\",\"百万架构师_spring 源码分析_手写orm框架顶层设计.md\":\"56a1976f\",\"百万架构师_并发编程_并发编程的原理(三).md\":\"1e248775\",\"百万架构师_spring 源码分析_spring5新特性及应用举例.md\":\"fd5d1778\",\"百万架构师_spring 源码分析_spring声明式事务操作实现原理.md\":\"3c453edc\",\"百万架构师_spring 源码分析_spring源码分析前篇.md\":\"52371ce7\",\"百万架构师_spring 源码分析_手写定制自己的orm框架.md\":\"ff63a4b7\",\"百万架构师_spring 源码分析_数据库事务操作原理及springaop配置.md\":\"ff1e0236\",\"百万架构师_spring 源码分析_深入分析ioc那些鲜为人知的细节.md\":\"0d930bda\",\"百万架构师_spring 源码分析_预习资料_spring5源码分析-预习资料.md\":\"d7fc295e\",\"百万架构师_spring 源码分析_spring核心ioc容器及依赖注入原理.md\":\"07abc86c\",\"百万架构师_kafka_kafkamanage.md\":\"81ab862c\",\"百万架构师_kafka_分布式消息通信kafka(一).md\":\"5a79d029\",\"百万架构师_kafka_分布式消息通信kafka(三).md\":\"ef2a392b\",\"百万架构师_分布式架构的基础_分布式系统的基石-序列化和反序列化.md\":\"71f4ea07\",\"百万架构师_nginx_nginx 应用实战.md\":\"1612a878\",\"百万架构师_协调服务-zookeeper_初步认识zookeeper.md\":\"d16a6655\",\"百万架构师_nginx_nginx 的初步认识.md\":\"61021046\",\"百万架构师_mybatis 源码分析_mybatis介绍使用和深度分析.md\":\"b1de5ed7\",\"百万架构师_并发编程_并发编程的基础.md\":\"2422458b\",\"百万架构师_漫谈分布式架构_分布式架构的演进过程.md\":\"1cd56fd6\",\"百万架构师_漫谈分布式架构_分布式架构设计.md\":\"f4a96ea5\",\"百万架构师_设计模式_spring种常用的设计模式及工厂模式详解.md\":\"5283f247\",\"百万架构师_设计模式_各种设计模式总结及应用场景.md\":\"a4709ea6\",\"百万架构师_设计模式_装饰器模式及观察者模式.md\":\"0ff79e92\",\"百万架构师_设计模式_设计模式容易混淆的几个对比.md\":\"bd457a78\",\"百万架构师_设计模式_设计模式预习资料_spring5源码分析-第1章.md\":\"99c3e8fe\",\"百万架构师_设计模式_设计模式预习资料_spring5源码分析-第2章.md\":\"dd9b5c1a\",\"百万架构师_协调服务-zookeeper_zookeeper的实践与原理.md\":\"d893e899\",\"百万架构师_nginx_nginx 的扩展-openrestry.md\":\"c5da16e4\",\"index.md\":\"45e2b258\",\"百万架构师_设计模式_策略模式及模板模式.md\":\"fdf8c73a\",\"百万架构师_并发编程_并发编程的原理(二).md\":\"9b0ecdb7\",\"百万架构师_协调服务-zookeeper_zookeeper实践之配合注册中心完成rpc手写.md\":\"97aaa90d\",\"百万架构师_协调服务-zookeeper_了解zookeeper的核心原理.md\":\"2bfb91eb\",\"百万架构师_并发编程_并发的框架.md\":\"264cb848\",\"百万架构师_设计模式_深度分析代理模式.md\":\"37a34981\",\"百万架构师_设计模式_委派模式及适配器模式.md\":\"e721e0c7\",\"百万架构师_设计模式_单例模式-原型模式.md\":\"e5c737e1\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-cmn-Hans\",\"dir\":\"ltr\",\"title\":\" JavaGuide.net \",\"description\":\"「JavaGuide.net」一份涵盖大部分 Java 程序员所需要掌握的核心知识。准备 Java 面试，首选 JavaGuide.net ！\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"关于我\",\"link\":\"https://nogeek.cn/\"},{\"text\":\"微码产品\",\"link\":\"https://mcode.net\"},{\"text\":\"❤软件方法❤\",\"link\":\"https://umlcn.com\"},{\"text\":\"百万架构师\",\"link\":\"/百万架构师/设计模式/设计模式预习资料/Spring5源码分析-第1章.html\",\"activeMatch\":\"/百万架构师\"},{\"text\":\"...\",\"items\":[{\"text\":\"友链\",\"link\":\"/links.html\",\"activeMatch\":\"/links\"}]}],\"logo\":\"/icon-180.png\",\"outline\":\"deep\",\"outlineTitle\":\"目录\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/nogeek-cn\"},{\"icon\":\"github\",\"link\":\"https://github.com/javaguide-net\"},{\"icon\":\"x\",\"link\":\"https://x.com/noGeek_cn\"},{\"icon\":\"youtube\",\"link\":\"https://www.youtube.com/@nogeek_cn\"},{\"icon\":{\"svg\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" aria-hidden=\\\"true\\\" role=\\\"img\\\" width=\\\"20\\\" height=\\\"20\\\"  viewBox=\\\"0 0 512 512\\\" >\\n<path fill=\\\"currentColor\\\" d=\\\"M488.6 104.1c16.7 18.1 24.4 39.7 23.3 65.7v202.4c-.4 26.4-9.2 48.1-26.5 65.1c-17.2 17-39.1 25.9-65.5 26.7H92.02c-26.45-.8-48.21-9.8-65.28-27.2C9.682 419.4.767 396.5 0 368.2V169.8c.767-26 9.682-47.6 26.74-65.7C43.81 87.75 65.57 78.77 92.02 78h29.38L96.05 52.19c-5.75-5.73-8.63-13-8.63-21.79c0-8.8 2.88-16.06 8.63-21.797C101.8 2.868 109.1 0 117.9 0s16.1 2.868 21.9 8.603L213.1 78h88l74.5-69.397C381.7 2.868 389.2 0 398 0c8.8 0 16.1 2.868 21.9 8.603c5.7 5.737 8.6 12.997 8.6 21.797c0 8.79-2.9 16.06-8.6 21.79L394.6 78h29.3c26.4.77 48 9.75 64.7 26.1zm-38.8 69.7c-.4-9.6-3.7-17.4-10.7-23.5c-5.2-6.1-14-9.4-22.7-9.8H96.05c-9.59.4-17.45 3.7-23.58 9.8c-6.14 6.1-9.4 13.9-9.78 23.5v194.4c0 9.2 3.26 17 9.78 23.5s14.38 9.8 23.58 9.8H416.4c9.2 0 17-3.3 23.3-9.8c6.3-6.5 9.7-14.3 10.1-23.5V173.8zm-264.3 42.7c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2c-6.2 6.3-14 9.5-23.6 9.5c-9.6 0-17.5-3.2-23.6-9.5c-6.1-6.3-9.4-14-9.8-23.2v-33.3c.4-9.1 3.8-16.9 10.1-23.2c6.3-6.3 13.2-9.6 23.3-10c9.2.4 17 3.7 23.3 10zm191.5 0c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2c-6.1 6.3-14 9.5-23.6 9.5c-9.6 0-17.4-3.2-23.6-9.5c-7-6.3-9.4-14-9.7-23.2v-33.3c.3-9.1 3.7-16.9 10-23.2c6.3-6.3 14.1-9.6 23.3-10c9.2.4 17 3.7 23.3 10z\\\"></path>\\n</svg>\"},\"link\":\"https://space.bilibili.com/392517565\"}],\"footer\":{\"message\":\"<a href=\\\"http://educode.cn\\\" target=\\\"_blank\\\" style=\\\"color: #337ab7; text-decoration: underline\\\">educode.cn</a>&nbsp &nbsp<a href=\\\"http://codeedu.cn\\\" target=\\\"_blank\\\" style=\\\"color: #337ab7; text-decoration: underline\\\">codeedu.cn</a>&nbsp &nbsp<a href=\\\"http://notgeek.cn\\\" target=\\\"_blank\\\" style=\\\"color: #337ab7; text-decoration: underline\\\">notgeek.cn</a>&nbsp &nbsp<br/><br/> Released under the MIT License.\",\"copyright\":\"Copyright © 2023-present <a href=\\\"http://nogeek.cn\\\" target=\\\"_blank\\\" style=\\\"color: #337ab7; text-decoration: underline\\\"> noGeek.cn </a> <br/><a href=\\\"https://beian.miit.gov.cn/\\\" target=\\\"_blank\\\" style=\\\"color: #337ab7;\\\"> 豫ICP备20012533号-6 </a> \"},\"docFooter\":{\"prev\":\"上一篇\",\"next\":\"下一篇\"},\"darkModeSwitchLabel\":\"切换主题\",\"sidebarMenuLabel\":\"菜单\",\"returnToTopLabel\":\"回到顶部\",\"langMenuLabel\":\"切换语言\",\"lastUpdatedText\":\"更新时间\",\"externalLinkIcon\":true,\"search\":{\"provider\":\"local\",\"options\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\"},\"modal\":{\"displayDetails\":\"显示详情\",\"noResultsText\":\"未找到相关结果\",\"resetButtonTitle\":\"清除\",\"footer\":{\"closeText\":\"关闭\",\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}}},\"sidebar\":{\"/百万架构师/\":[{\"text\":\"设计模式\",\"collapsed\":true,\"items\":[{\"text\":\"设计模式预习资料\",\"collapsed\":false,\"items\":[{\"text\":\"Spring5源码分析-第1章\",\"link\":\"/百万架构师/设计模式/设计模式预习资料/Spring5源码分析-第1章\"},{\"text\":\"Spring5源码分析-第2章\",\"link\":\"/百万架构师/设计模式/设计模式预习资料/Spring5源码分析-第2章\"}]},{\"text\":\"Spring种常用的设计模式及工厂模式详解\",\"link\":\"/百万架构师/设计模式/Spring种常用的设计模式及工厂模式详解\"},{\"text\":\"单例模式-原型模式\",\"link\":\"/百万架构师/设计模式/单例模式-原型模式\"},{\"text\":\"深度分析代理模式\",\"link\":\"/百万架构师/设计模式/深度分析代理模式\"},{\"text\":\"策略模式及模板模式\",\"link\":\"/百万架构师/设计模式/策略模式及模板模式\"},{\"text\":\"委派模式及适配器模式\",\"link\":\"/百万架构师/设计模式/委派模式及适配器模式\"},{\"text\":\"装饰器模式及观察者模式\",\"link\":\"/百万架构师/设计模式/装饰器模式及观察者模式\"},{\"text\":\"各种设计模式总结及应用场景\",\"link\":\"/百万架构师/设计模式/各种设计模式总结及应用场景\"},{\"text\":\"设计模式容易混淆的几个对比\",\"link\":\"/百万架构师/设计模式/设计模式容易混淆的几个对比\"}]},{\"text\":\"Mybatis 源码分析\",\"collapsed\":true,\"items\":[{\"text\":\"Mybatis介绍使用和深度分析\",\"link\":\"/百万架构师/Mybatis 源码分析/Mybatis介绍使用和深度分析\"}]},{\"text\":\"Spring 源码分析\",\"collapsed\":true,\"items\":[{\"text\":\"预习资料\",\"collapsed\":false,\"items\":[{\"text\":\"Spring5源码分析-预习资料\",\"link\":\"/百万架构师/Spring 源码分析/预习资料/Spring5源码分析-预习资料\"}]},{\"text\":\"Spring源码分析前篇\",\"link\":\"/百万架构师/Spring 源码分析/Spring源码分析前篇\"},{\"text\":\"Spring系统概述及IOC实现原理\",\"link\":\"/百万架构师/Spring 源码分析/Spring系统概述及IOC实现原理\"},{\"text\":\"Spring核心IOC容器及依赖注入原理\",\"link\":\"/百万架构师/Spring 源码分析/Spring核心IOC容器及依赖注入原理\"},{\"text\":\"深入分析IOC那些鲜为人知的细节\",\"link\":\"/百万架构师/Spring 源码分析/深入分析IOC那些鲜为人知的细节\"},{\"text\":\"手写SpringIOC核心代码\",\"link\":\"/百万架构师/Spring 源码分析/手写SpringIOC核心代码\"},{\"text\":\"SpringMVC核心原理及源码分析\",\"link\":\"/百万架构师/Spring 源码分析/SpringMVC核心原理及源码分析\"},{\"text\":\"手写SpringMVC2.0版本\",\"link\":\"/百万架构师/Spring 源码分析/手写SpringMVC2.0版本\"},{\"text\":\"手写SpringAOP核心原理\",\"link\":\"/百万架构师/Spring 源码分析/手写SpringAOP核心原理\"},{\"text\":\"Spring声明式事务操作实现原理\",\"link\":\"/百万架构师/Spring 源码分析/Spring声明式事务操作实现原理\"},{\"text\":\"数据库事务操作原理及SpringAOP配置\",\"link\":\"/百万架构师/Spring 源码分析/数据库事务操作原理及SpringAOP配置\"},{\"text\":\"手写ORM框架顶层设计\",\"link\":\"/百万架构师/Spring 源码分析/手写ORM框架顶层设计\"},{\"text\":\"手写定制自己的ORM框架\",\"link\":\"/百万架构师/Spring 源码分析/手写定制自己的ORM框架\"},{\"text\":\"Spring5新特性及应用举例\",\"link\":\"/百万架构师/Spring 源码分析/Spring5新特性及应用举例\"},{\"text\":\"Spring经典面试答疑\",\"link\":\"/百万架构师/Spring 源码分析/Spring经典面试答疑\"}]},{\"text\":\"漫谈分布式架构\",\"collapsed\":true,\"items\":[{\"text\":\"分布式架构的演进过程\",\"link\":\"/百万架构师/漫谈分布式架构/分布式架构的演进过程\"},{\"text\":\"分布式架构设计\",\"link\":\"/百万架构师/漫谈分布式架构/分布式架构设计\"}]},{\"text\":\"分布式架构的基础\",\"collapsed\":true,\"items\":[{\"text\":\"分布式系统的基石TCP-IP通讯协议\",\"link\":\"/百万架构师/分布式架构的基础/分布式系统的基石TCP-IP通讯协议\"},{\"text\":\"分布式系统的基石HTTP协议与HTTPS协议\",\"link\":\"/百万架构师/分布式架构的基础/分布式系统的基石HTTP协议与HTTPS协议\"},{\"text\":\"分布式系统的基石-序列化和反序列化\",\"link\":\"/百万架构师/分布式架构的基础/分布式系统的基石-序列化和反序列化\"}]},{\"text\":\"RMI\",\"collapsed\":true,\"items\":[{\"text\":\"分布式通讯框架RMI的原理\",\"link\":\"/百万架构师/RMI/分布式通讯框架RMI的原理\"}]},{\"text\":\"协调服务-zookeeper\",\"collapsed\":true,\"items\":[{\"text\":\"初步认识zookeeper\",\"link\":\"/百万架构师/协调服务-zookeeper/初步认识zookeeper\"},{\"text\":\"了解zookeeper的核心原理\",\"link\":\"/百万架构师/协调服务-zookeeper/了解zookeeper的核心原理\"},{\"text\":\"zookeeper实践之配合注册中心完成RPC手写\",\"link\":\"/百万架构师/协调服务-zookeeper/zookeeper实践之配合注册中心完成RPC手写\"},{\"text\":\"zookeeper的实践与原理\",\"link\":\"/百万架构师/协调服务-zookeeper/zookeeper的实践与原理\"}]},{\"text\":\"kafka\",\"collapsed\":true,\"items\":[{\"text\":\"分布式消息通信Kafka(一)\",\"link\":\"/百万架构师/kafka/分布式消息通信Kafka(一)\"},{\"text\":\"分布式消息通信Kafka(二)\",\"link\":\"/百万架构师/kafka/分布式消息通信Kafka(二)\"},{\"text\":\"分布式消息通信Kafka(三)\",\"link\":\"/百万架构师/kafka/分布式消息通信Kafka(三)\"},{\"text\":\"KafkaManage\",\"link\":\"/百万架构师/kafka/KafkaManage\"}]},{\"text\":\"RabbitMq\",\"collapsed\":true,\"items\":[{\"text\":\"高可用集群搭建步骤\",\"link\":\"/百万架构师/RabbitMq/高可用集群搭建步骤\"},{\"text\":\"Windows安装RabbitMq\",\"link\":\"/百万架构师/RabbitMq/Windows安装RabbitMq\"},{\"text\":\"Linux安装RabbitMq\",\"link\":\"/百万架构师/RabbitMq/Linux安装RabbitMq\"},{\"text\":\"RabbitMq-工作模型与JAVA编程\",\"link\":\"/百万架构师/RabbitMq/RabbitMq-工作模型与JAVA编程\"},{\"text\":\"可靠性投递和实践经验\",\"link\":\"/百万架构师/RabbitMq/可靠性投递和实践经验\"}]},{\"text\":\"Nginx\",\"collapsed\":true,\"items\":[{\"text\":\"Nginx 的初步认识\",\"link\":\"/百万架构师/Nginx/Nginx 的初步认识\"},{\"text\":\"Nginx 应用实战\",\"link\":\"/百万架构师/Nginx/Nginx 应用实战\"},{\"text\":\"Nginx 的扩展-OpenRestry\",\"link\":\"/百万架构师/Nginx/Nginx 的扩展-OpenRestry\"}]},{\"text\":\"并发编程\",\"collapsed\":true,\"items\":[{\"text\":\"并发编程的基础\",\"link\":\"/百万架构师/并发编程/并发编程的基础\"},{\"text\":\"并发编程的原理(一)\",\"link\":\"/百万架构师/并发编程/并发编程的原理(一)\"},{\"text\":\"并发编程的原理(二)\",\"link\":\"/百万架构师/并发编程/并发编程的原理(二)\"},{\"text\":\"并发编程的原理(三)\",\"link\":\"/百万架构师/并发编程/并发编程的原理(三)\"},{\"text\":\"并发的框架\",\"link\":\"/百万架构师/并发编程/并发的框架\"}]}],\"/links.md/\":[]}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>